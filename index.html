<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ShiftTrack Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--p:#a78bfa;--p2:#8b5cf6;--p3:#c4b5fd;--p4:rgba(139,92,246,.12);--pg:linear-gradient(135deg,#7c3aed,#8b5cf6);
--acc:#fbbf24;--g:#34d399;--r:#f87171;--s:#38bdf8;
--bg:#0f0d1a;--bg2:#1a1726;--bg3:#231f33;--bg4:#2d2844;
--card:#1a1726;--card2:#231f33;--glass:rgba(26,23,38,.88);
--t1:#f1f0f5;--t2:#9893a7;--t3:#5e5875;--b1:#2d2844;--b2:#352f4a;
--rad:14px;--rad2:20px;--sh1:0 2px 8px rgba(0,0,0,.3);--sh2:0 8px 24px rgba(0,0,0,.4);--sh3:0 16px 48px rgba(0,0,0,.5);--transition-speed:.3s;
}
body.theme-ocean{--p:#22d3ee;--p2:#06b6d4;--p3:#67e8f9;--p4:rgba(6,182,212,.12);--pg:linear-gradient(135deg,#0891b2,#06b6d4);--bg:#0a1520;--bg2:#0f1f2e;--bg3:#17293a;--bg4:#1f3347;--card:#0f1f2e;--card2:#17293a;--glass:rgba(15,31,46,.88);--b1:#1f3347;--b2:#274055;--t1:#e8f4f8;--t2:#7ba8be;--t3:#4a7a92}
body.theme-forest{--p:#4ade80;--p2:#22c55e;--p3:#86efac;--p4:rgba(34,197,94,.12);--pg:linear-gradient(135deg,#16a34a,#22c55e);--bg:#0a160e;--bg2:#0f1f14;--bg3:#17291d;--bg4:#1f3327;--card:#0f1f14;--card2:#17291d;--glass:rgba(15,31,20,.88);--b1:#1f3327;--b2:#274030;--t1:#e8f5ec;--t2:#7bba8d;--t3:#4a8a5e}
body.theme-sunset{--p:#fb923c;--p2:#f97316;--p3:#fdba74;--p4:rgba(249,115,22,.12);--pg:linear-gradient(135deg,#ea580c,#f97316);--bg:#1a0f0a;--bg2:#261810;--bg3:#332117;--bg4:#40291e;--card:#261810;--card2:#332117;--glass:rgba(38,24,16,.88);--b1:#40291e;--b2:#4d3225;--t1:#faf0e8;--t2:#c49a78;--t3:#8a6a4e}
body.theme-rose{--p:#fb7185;--p2:#f43f5e;--p3:#fda4af;--p4:rgba(244,63,94,.12);--pg:linear-gradient(135deg,#e11d48,#f43f5e);--bg:#1a0d12;--bg2:#26141b;--bg3:#331b24;--bg4:#40222d;--card:#26141b;--card2:#331b24;--glass:rgba(38,20,27,.88);--b1:#40222d;--b2:#4d2936;--t1:#fae8ed;--t2:#c4788a;--t3:#8a4e5e}
body.theme-gold{--p:#fbbf24;--p2:#f59e0b;--p3:#fde68a;--p4:rgba(245,158,11,.12);--pg:linear-gradient(135deg,#d97706,#f59e0b);--bg:#161209;--bg2:#211b0f;--bg3:#2c2416;--bg4:#372d1d;--card:#211b0f;--card2:#2c2416;--glass:rgba(33,27,15,.88);--b1:#372d1d;--b2:#423624;--t1:#faf5e8;--t2:#c4a878;--t3:#8a7a4e}
html{scroll-behavior:smooth}
body{font-family:'Plus Jakarta Sans',system-ui,sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;overflow-x:hidden;transition:background var(--transition-speed),color var(--transition-speed)}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--p2);border-radius:10px}
.toast-container{position:fixed;top:70px;right:16px;z-index:2000;display:flex;flex-direction:column;gap:8px;pointer-events:none}
.toast{padding:12px 18px;border-radius:12px;background:var(--card);border:1px solid var(--b1);box-shadow:var(--sh3);display:flex;align-items:center;gap:10px;font-size:13px;font-weight:600;animation:toastIn .4s cubic-bezier(.16,1,.3,1),toastOut .3s ease forwards;animation-delay:0s,2.5s;pointer-events:auto;backdrop-filter:blur(16px);max-width:340px}
.toast i{font-size:16px;flex-shrink:0}
.toast.t-success{border-color:rgba(52,211,153,.3);color:var(--g)}.toast.t-error{border-color:rgba(248,113,113,.3);color:var(--r)}.toast.t-info{border-color:var(--p4);color:var(--p)}.toast.t-warning{border-color:rgba(251,191,36,.3);color:var(--acc)}
@keyframes toastIn{from{opacity:0;transform:translateX(60px) scale(.9)}to{opacity:1;transform:none}}
@keyframes toastOut{to{opacity:0;transform:translateX(60px) scale(.9)}}
.confirm-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:3000;padding:16px}.confirm-overlay.show{display:flex}
.confirm-box{background:var(--bg2);border-radius:var(--rad2);padding:28px;max-width:360px;width:100%;text-align:center;border:1px solid var(--b1);box-shadow:var(--sh3);animation:modalPop .3s cubic-bezier(.16,1,.3,1)}
.confirm-box .confirm-icon{width:56px;height:56px;border-radius:50%;margin:0 auto 16px;display:flex;align-items:center;justify-content:center;font-size:24px}.confirm-box .confirm-icon.ci-danger{background:rgba(248,113,113,.12);color:var(--r)}
.confirm-box h4{font-size:16px;font-weight:800;margin-bottom:6px;color:var(--t1)}.confirm-box p{font-size:13px;color:var(--t2);margin-bottom:20px;line-height:1.5}.confirm-box .confirm-btns{display:flex;gap:8px;justify-content:center}
.streak-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;background:var(--p4);color:var(--p);border:1px solid rgba(255,255,255,.06)}.streak-badge i{font-size:12px}
#loginScreen{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(160deg,var(--bg) 0%,var(--bg2) 40%,var(--bg4) 100%);position:relative;overflow:hidden}
#loginScreen::before{content:'';position:absolute;width:500px;height:500px;background:radial-gradient(circle,var(--p4),transparent 70%);top:-150px;right:-80px;border-radius:50%;animation:p1 8s ease-in-out infinite}
#loginScreen::after{content:'';position:absolute;width:350px;height:350px;background:radial-gradient(circle,rgba(56,189,248,.08),transparent 70%);bottom:-80px;left:-40px;border-radius:50%;animation:p2 10s ease-in-out infinite}
@keyframes p1{0%,100%{transform:scale(1);opacity:.5}50%{transform:scale(1.3);opacity:.8}}@keyframes p2{0%,100%{transform:scale(1.2);opacity:.4}50%{transform:scale(.9);opacity:.7}}
.login-container{position:relative;z-index:2;text-align:center;animation:rise .8s cubic-bezier(.16,1,.3,1)}
@keyframes rise{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:none}}
.login-brand{margin-bottom:44px}.login-brand .icon{width:68px;height:68px;background:var(--p4);border:1px solid rgba(255,255,255,.08);border-radius:20px;display:inline-flex;align-items:center;justify-content:center;font-size:30px;margin-bottom:14px;color:var(--p);transition:transform .3s}.login-brand .icon:hover{transform:rotate(-10deg) scale(1.1)}
.login-brand h1{font-size:34px;font-weight:900;color:var(--t1);letter-spacing:-.5px}.login-brand p{color:var(--t3);font-size:14px;margin-top:6px}.login-brand .version{display:inline-block;margin-top:8px;padding:3px 10px;border-radius:20px;font-size:10px;font-weight:700;background:var(--p4);color:var(--p);border:1px solid rgba(255,255,255,.06)}
.login-cards{display:flex;gap:18px;flex-wrap:wrap;justify-content:center}
.login-card{width:200px;padding:32px 20px;border-radius:var(--rad2);background:rgba(255,255,255,.04);backdrop-filter:blur(16px);border:1px solid var(--b1);cursor:pointer;transition:all .35s cubic-bezier(.16,1,.3,1);color:var(--t1)}.login-card:hover{background:rgba(255,255,255,.08);border-color:var(--p);transform:translateY(-6px);box-shadow:0 16px 32px rgba(0,0,0,.3)}.login-card:active{transform:translateY(-2px) scale(.98)}
.login-card .avatar{width:64px;height:64px;border-radius:50%;margin:0 auto 14px;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:800;background:var(--pg);border:2px solid rgba(255,255,255,.1);color:#fff;transition:transform .3s}.login-card:hover .avatar{transform:scale(1.08)}
.login-card h3{font-size:15px;font-weight:700;margin-bottom:3px;color:var(--t1)}.login-card span{font-size:11px;color:var(--t3);font-weight:500}.login-card .last-login{display:block;font-size:10px;color:var(--t3);margin-top:6px;opacity:.6}
.user-theme-indicator{display:flex;align-items:center;gap:6px;margin-top:10px;justify-content:center}.uti-dot{width:12px;height:12px;border-radius:50%;border:2px solid rgba(255,255,255,.15)}.uti-text{font-size:10px;color:var(--t3);font-weight:600}
#mainApp{display:none;min-height:100vh}
.topbar{position:fixed;top:0;left:0;right:0;height:56px;background:var(--glass);backdrop-filter:blur(20px);border-bottom:1px solid var(--b1);display:flex;align-items:center;padding:0 20px;z-index:100;transition:all var(--transition-speed)}
.topbar-brand{display:flex;align-items:center;gap:8px;font-size:16px;font-weight:800;color:var(--p)}.topbar-brand .ico{width:32px;height:32px;background:var(--pg);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px}
.topbar-right{margin-left:auto;display:flex;align-items:center;gap:10px}
.topbar-user{display:flex;align-items:center;gap:8px;padding:4px 12px 4px 4px;border-radius:50px;background:var(--p4);cursor:pointer;transition:all .2s}.topbar-user:hover{background:rgba(255,255,255,.08)}.topbar-user .av{width:28px;height:28px;border-radius:50%;background:var(--pg);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:11px}.topbar-user span{font-size:12px;font-weight:600;color:var(--p3)}
.topbar-logout{width:32px;height:32px;border-radius:8px;border:1px solid var(--b1);background:transparent;cursor:pointer;color:var(--t3);font-size:13px;display:flex;align-items:center;justify-content:center;transition:all .2s}.topbar-logout:hover{background:rgba(248,113,113,.1);color:var(--r);border-color:rgba(248,113,113,.3)}
.nav-tabs{position:fixed;top:56px;left:0;right:0;height:54px;background:var(--glass);backdrop-filter:blur(20px);border-bottom:1px solid var(--b1);display:flex;align-items:center;justify-content:center;padding:0 12px;gap:4px;z-index:99;transition:all var(--transition-speed)}
.nav-tab{flex:1;max-width:160px;padding:9px 6px;border-radius:12px;border:none;background:transparent;font-family:inherit;font-size:13px;font-weight:700;color:var(--t3);cursor:pointer;transition:all .25s;display:flex;align-items:center;justify-content:center;gap:7px;white-space:nowrap}.nav-tab:hover{background:var(--p4);color:var(--p)}.nav-tab.active{background:var(--p2);color:#fff;box-shadow:0 2px 12px rgba(0,0,0,.3)}.nav-tab i{font-size:16px}.nav-tab span{font-size:12px;font-weight:700}
.content{padding:126px 24px 36px;max-width:1200px;margin:0 auto}
.page{display:none;animation:pageIn .35s cubic-bezier(.16,1,.3,1)}.page.active{display:block}@keyframes pageIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:none}}
.page-head{margin-bottom:24px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}.page-head div:first-child h1{font-size:24px;font-weight:900;letter-spacing:-.3px;color:var(--t1)}.page-head div:first-child p{color:var(--t2);font-size:13px;margin-top:3px;font-weight:500}
.card{background:var(--card);border-radius:var(--rad);padding:20px;box-shadow:var(--sh1);border:1px solid var(--b1);transition:all var(--transition-speed)}.card:hover{box-shadow:var(--sh2)}
.card-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.card-head h3{font-size:14px;font-weight:700;display:flex;align-items:center;gap:7px;color:var(--t1)}.card-head h3 i{color:var(--p);font-size:14px}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:20px}
.stat{background:var(--card);border-radius:var(--rad);padding:16px;box-shadow:var(--sh1);border:1px solid var(--b1);transition:all .3s;position:relative;overflow:hidden;cursor:default}.stat:hover{transform:translateY(-2px);box-shadow:var(--sh2)}.stat .ribbon{position:absolute;top:0;left:0;right:0;height:2px;background:var(--pg)}.stat .ico{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:15px;margin-bottom:10px;background:var(--p4);color:var(--p)}.stat .val{font-size:22px;font-weight:900;letter-spacing:-.5px;color:var(--t1)}.stat .lbl{font-size:11px;color:var(--t2);margin-top:3px;font-weight:600;text-transform:uppercase;letter-spacing:.3px}.stat .change{font-size:10px;font-weight:700;margin-top:4px;display:flex;align-items:center;gap:3px}.stat .change.up{color:var(--g)}.stat .change.down{color:var(--r)}.stat .change.neutral{color:var(--t3)}
.grid-2{display:grid;grid-template-columns:1.4fr 1fr;gap:16px}.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-top:16px}
.week-chart{display:flex;flex-direction:column;gap:10px}.wk-row{display:flex;align-items:center;gap:10px}.wk-row .label{min-width:50px;font-size:11px;font-weight:700;color:var(--t2)}.wk-row .track{flex:1;height:24px;background:var(--bg3);border-radius:6px;overflow:hidden;position:relative}.wk-row .limit-line{position:absolute;left:75%;top:0;bottom:0;width:1px;background:rgba(248,113,113,.4);z-index:1}.wk-row .fill{height:100%;border-radius:6px;display:flex;align-items:center;padding-left:8px;font-size:10px;font-weight:700;color:#fff;transition:width .8s cubic-bezier(.16,1,.3,1)}.wk-row .fill.ok{background:var(--pg)}.wk-row .fill.ot{background:linear-gradient(90deg,#f59e0b,#fbbf24)}.wk-row .hrs{min-width:44px;text-align:right;font-size:12px;font-weight:800;color:var(--t1)}.wk-row .hrs.overtime{color:var(--acc)}
.info-list{display:flex;flex-direction:column}.info-row{display:flex;justify-content:space-between;align-items:center;padding:10px 4px;border-bottom:1px solid var(--b1);font-size:13px;transition:background .2s;border-radius:4px}.info-row:last-child{border:none}.info-row:hover{background:var(--bg3)}.info-row .k{color:var(--t2);display:flex;align-items:center;gap:7px;font-weight:500}.info-row .k i{color:var(--p)}.info-row .v{font-weight:700;color:var(--t1)}.info-row .v.pos{color:var(--g)}.info-row .v.neg{color:var(--r)}.info-row .v.warn{color:var(--acc)}
.sd-item{display:flex;align-items:center;gap:12px}.sd-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;background:var(--p4)}.sd-info{flex:1;min-width:0}.sd-info .sd-name{font-size:12px;font-weight:700;margin-bottom:2px;color:var(--t1)}.sd-info .sd-time{font-size:10px;color:var(--t3);font-weight:600}.sd-bar-wrap{height:6px;background:var(--bg3);border-radius:3px;overflow:hidden;margin-top:4px}.sd-bar{height:100%;border-radius:3px;transition:width .8s cubic-bezier(.16,1,.3,1);background:var(--pg)}.sd-stats{display:flex;align-items:center;gap:8px;flex-shrink:0;min-width:80px;justify-content:flex-end}.sd-count{font-size:18px;font-weight:900;color:var(--p)}.sd-unit{font-size:10px;color:var(--t3);font-weight:600}.sd-pct{font-size:10px;font-weight:700;color:var(--t2);background:var(--bg3);padding:2px 6px;border-radius:4px}.sd-summary{display:flex;gap:8px;margin-top:14px;padding-top:14px;border-top:1px solid var(--b1);flex-wrap:wrap}.sd-chip{display:flex;align-items:center;gap:5px;padding:6px 12px;border-radius:8px;background:var(--bg3);border:1px solid var(--b1);font-size:11px;font-weight:700;color:var(--t2)}.sd-chip .chip-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;background:var(--p)}.sd-donut{position:relative;width:100px;height:100px;margin:0 auto 10px}.sd-donut svg{width:100%;height:100%;transform:rotate(-90deg)}.sd-donut .donut-center{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column}.sd-donut .donut-center .dc-val{font-size:20px;font-weight:900;color:var(--t1)}.sd-donut .donut-center .dc-lbl{font-size:9px;color:var(--t3);font-weight:600;text-transform:uppercase}
.cal-controls{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px}.cal-nav{display:flex;align-items:center;gap:6px}.cal-nav-btn{width:36px;height:36px;border-radius:10px;border:1px solid var(--b1);background:var(--card);cursor:pointer;font-size:13px;color:var(--t1);transition:all .2s;display:flex;align-items:center;justify-content:center}.cal-nav-btn:hover{background:var(--p2);color:#fff;border-color:var(--p2)}.cal-nav-btn:active{transform:scale(.95)}.cal-month-title{font-size:18px;font-weight:800;min-width:180px;text-align:center;color:var(--t1)}
.btn{padding:8px 16px;border-radius:10px;font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;border:none;transition:all .25s;display:inline-flex;align-items:center;gap:6px;user-select:none}.btn:active{transform:scale(.96)}.btn-primary{background:var(--p2);color:#fff;box-shadow:0 3px 10px rgba(0,0,0,.3)}.btn-primary:hover{background:var(--p);transform:translateY(-1px)}.btn-soft{background:var(--p4);color:var(--p)}.btn-soft:hover{background:rgba(255,255,255,.08)}.btn-outline{background:transparent;border:1.5px solid var(--b1);color:var(--t2)}.btn-outline:hover{border-color:var(--p);color:var(--p);background:var(--p4)}.btn-danger{background:transparent;border:1.5px solid rgba(248,113,113,.3);color:var(--r)}.btn-danger:hover{background:var(--r);color:#fff}.btn-ghost{background:none;border:1.5px solid var(--b1);color:var(--t2)}.btn-ghost:hover{background:var(--bg3)}.btn-sm{padding:5px 12px;font-size:11px;border-radius:7px}.btn-xs{padding:3px 8px;font-size:10px;border-radius:5px}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}.cal-dname{text-align:center;font-size:10px;font-weight:700;color:var(--t3);padding:8px 0;text-transform:uppercase;letter-spacing:.8px}
.cal-cell{min-height:82px;border-radius:10px;padding:6px 7px;cursor:pointer;border:1.5px solid transparent;transition:all .2s;background:var(--card2);position:relative}.cal-cell:hover{border-color:var(--p);box-shadow:var(--sh2);transform:translateY(-1px);z-index:2}.cal-cell:active{transform:scale(.97)}.cal-cell.out{opacity:.12;pointer-events:none}.cal-cell.today{border-color:var(--p);background:var(--p4)}.cal-cell.today::after{content:'';position:absolute;top:4px;right:4px;width:6px;height:6px;border-radius:50%;background:var(--p);animation:todayPulse 2s ease-in-out infinite}@keyframes todayPulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(1.3)}}.cal-cell.holiday{background:rgba(248,113,113,.06);border-color:rgba(248,113,113,.12)}.cal-cell.has-shift{background:rgba(52,211,153,.06);border-color:rgba(52,211,153,.1)}.cal-cell.leave-annual{background:rgba(96,165,250,.08);border-color:rgba(96,165,250,.2)}.cal-cell.leave-weekly{background:var(--p4);border-color:rgba(255,255,255,.06)}.cal-cell.leave-sick{background:rgba(251,146,60,.08);border-color:rgba(251,146,60,.2)}.cal-cell.leave-unpaid{background:rgba(148,163,184,.08);border-color:rgba(148,163,184,.2)}.cal-cell .num{font-size:12px;font-weight:800;display:flex;justify-content:space-between;align-items:center;margin-bottom:3px;color:var(--t1)}.cal-cell .num small{font-weight:500;color:var(--t3);font-size:9px}.cal-cell .hrs-display{font-size:16px;font-weight:900;color:var(--g);line-height:1;margin:2px 0}.cal-cell .hrs-display.overtime{color:var(--acc)}.cal-cell .shift-time{font-size:9px;color:var(--t2);font-weight:600}.cal-cell .leave-display{margin-top:2px;display:flex;align-items:center;gap:4px;font-size:10px;font-weight:800;line-height:1.2}.cal-cell .leave-display i{font-size:12px}.cal-cell .leave-display.ld-annual{color:#60a5fa}.cal-cell .leave-display.ld-weekly{color:var(--p)}.cal-cell .leave-display.ld-sick{color:#fb923c}.cal-cell .leave-display.ld-unpaid{color:#94a3b8}.cal-cell .leave-label{font-size:9px;font-weight:700;padding:2px 6px;border-radius:4px;display:inline-block;margin-top:1px}.cal-cell .leave-label.ll-annual{background:rgba(96,165,250,.15);color:#60a5fa}.cal-cell .leave-label.ll-weekly{background:var(--p4);color:var(--p)}.cal-cell .leave-label.ll-sick{background:rgba(251,146,60,.15);color:#fb923c}.cal-cell .leave-label.ll-unpaid{background:rgba(148,163,184,.15);color:#94a3b8}.cal-cell .hol-tag{font-size:8px;font-weight:700;padding:2px 5px;border-radius:4px;background:rgba(248,113,113,.15);color:var(--r);display:inline-block;margin-top:1px}
.cal-legend{display:flex;gap:14px;margin-top:14px;flex-wrap:wrap}.cal-legend span{display:flex;align-items:center;gap:5px;font-size:11px;font-weight:600;color:var(--t2)}.cal-legend span i{font-size:8px}
.copy-bar{background:var(--p4);border:1px solid rgba(255,255,255,.06);border-radius:10px;padding:10px 14px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;font-size:12px;font-weight:600;color:var(--p3);animation:pageIn .3s ease}
.multi-select-bar{background:rgba(52,211,153,.08);border:1px solid rgba(52,211,153,.2);border-radius:10px;padding:10px 14px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;font-size:12px;font-weight:600;color:var(--g);animation:pageIn .3s ease;gap:8px}.multi-select-bar .actions{display:flex;gap:6px}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:1000;padding:16px}.overlay.show{display:flex}
.modal{background:var(--bg2);border-radius:var(--rad2);width:420px;max-width:100%;max-height:90vh;overflow-y:auto;box-shadow:var(--sh3);border:1px solid var(--b1);animation:modalPop .3s cubic-bezier(.16,1,.3,1)}@keyframes modalPop{from{opacity:0;transform:scale(.94) translateY(10px)}to{opacity:1;transform:none}}
.modal-top{padding:16px 18px 0;display:flex;justify-content:space-between;align-items:center}.modal-top h3{font-size:16px;font-weight:800;color:var(--t1)}.modal-top .date-badge{font-size:11px;color:var(--t2);font-weight:600;background:var(--bg3);padding:4px 10px;border-radius:6px}
.modal-x{width:30px;height:30px;border-radius:8px;border:1px solid var(--b1);background:none;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;color:var(--t3);transition:all .2s}.modal-x:hover{background:rgba(248,113,113,.1);color:var(--r);border-color:rgba(248,113,113,.3)}
.modal-body{padding:12px 18px}.modal-foot{padding:0 18px 16px;display:flex;gap:8px;justify-content:flex-end}
.h-alert{background:rgba(248,113,113,.08);border:1px solid rgba(248,113,113,.2);border-radius:10px;padding:10px 12px;display:flex;align-items:center;gap:8px;margin-bottom:12px;font-size:11px;color:var(--r);font-weight:600}.h-alert i{font-size:14px;flex-shrink:0}
.mode-tabs{display:flex;gap:4px;background:var(--bg);border-radius:10px;padding:3px;margin-bottom:12px}.mode-tab{flex:1;padding:8px;border:none;background:none;border-radius:8px;font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;color:var(--t3);transition:all .2s;display:flex;align-items:center;justify-content:center;gap:5px}.mode-tab.active{background:var(--card2);color:var(--p);box-shadow:var(--sh1)}.mode-tab:hover:not(.active){color:var(--t1)}
.preset-row{display:flex;gap:5px;margin-bottom:12px}.preset{flex:1;padding:8px 4px;border-radius:8px;border:1.5px solid var(--b1);cursor:pointer;text-align:center;transition:all .2s;background:var(--card2)}.preset:hover{border-color:var(--p);background:var(--p4)}.preset.active{border-color:var(--p);background:var(--p4)}.preset .p-icon{font-size:16px;display:block;margin-bottom:2px}.preset .p-name{font-size:9px;font-weight:700;color:var(--t1);display:block}.preset .p-time{font-size:8px;color:var(--t3);font-weight:600;display:block;margin-top:1px}
.time-inputs{display:flex;gap:6px;margin-bottom:10px;align-items:end}.time-inputs .ti{flex:1}.time-inputs .ti label{display:block;font-size:9px;font-weight:700;color:var(--t3);margin-bottom:3px;text-transform:uppercase;letter-spacing:.3px}
input[type="time"],input[type="text"],input[type="number"],input[type="date"],select{width:100%;padding:8px;border:1.5px solid var(--b1);border-radius:8px;font-family:inherit;font-size:13px;font-weight:600;transition:all .2s;background:var(--bg3);color:var(--t1)}input:focus,select:focus{outline:none;border-color:var(--p);box-shadow:0 0 0 3px var(--p4)}input[type="time"]{font-size:14px;font-weight:800;text-align:center;padding:7px 4px}
.result-box{background:var(--bg);border-radius:10px;padding:10px;display:flex;justify-content:space-between;align-items:center;border:1px solid var(--b1)}.result-box .rb-item{text-align:center;flex:1}.result-box .rb-val{font-size:16px;font-weight:900;color:var(--p)}.result-box .rb-val.accent{color:var(--acc)}.result-box .rb-val.green{color:var(--g)}.result-box .rb-lbl{font-size:8px;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:.2px;margin-top:1px}.result-box .rb-div{width:1px;height:28px;background:var(--b1)}
.lt-row{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:10px}.lt-opt{padding:12px 6px;border-radius:10px;border:1.5px solid var(--b1);cursor:pointer;text-align:center;font-size:11px;font-weight:700;transition:all .2s;color:var(--t2);background:var(--card2)}.lt-opt:hover{border-color:var(--p);background:var(--p4)}.lt-opt.active{border-color:var(--p);background:var(--p4);color:var(--p)}.lt-opt i{display:block;font-size:18px;margin-bottom:4px}.lt-opt small{display:block;font-size:8px;color:var(--t3);font-weight:500;margin-top:2px}
.fg{margin-bottom:10px}.fg label{display:block;font-size:9px;font-weight:700;color:var(--t3);margin-bottom:3px;text-transform:uppercase;letter-spacing:.3px}
.leave-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:20px}.leave-c{padding:18px}.leave-c h4{font-size:12px;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:7px;color:var(--t2)}.leave-c .big{font-size:26px;font-weight:900;letter-spacing:-.5px}.leave-c .big small{font-size:13px;font-weight:600;color:var(--t3)}.pbar{height:5px;background:var(--bg3);border-radius:3px;overflow:hidden;margin:10px 0 6px}.pbar .pf{height:100%;border-radius:3px;transition:width .7s cubic-bezier(.16,1,.3,1)}.leave-c .meta{display:flex;justify-content:space-between;font-size:10px;font-weight:600;color:var(--t3)}
table{width:100%;border-collapse:separate;border-spacing:0}th{text-align:left;padding:8px 12px;font-size:10px;font-weight:700;color:var(--t3);text-transform:uppercase;letter-spacing:.5px;border-bottom:1.5px solid var(--b1)}td{padding:10px 12px;font-size:12px;font-weight:500;border-bottom:1px solid var(--b1);color:var(--t1)}tr:hover td{background:var(--bg3)}.tag{padding:3px 8px;border-radius:20px;font-size:9px;font-weight:700;display:inline-block}.tag-a{background:rgba(96,165,250,.15);color:#60a5fa}.tag-s{background:rgba(251,146,60,.15);color:#fb923c}.tag-w{background:var(--p4);color:var(--p)}.tag-u{background:rgba(148,163,184,.15);color:#94a3b8}
.earn-hero{background:var(--pg);color:#fff;border-radius:var(--rad2);padding:28px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,.1)}.earn-hero::before{content:'₺';position:absolute;right:20px;bottom:-16px;font-size:100px;font-weight:900;opacity:.08}.earn-hero .sub{font-size:12px;opacity:.6;font-weight:600}.earn-hero .amt{font-size:34px;font-weight:900;margin:6px 0}.earn-hero .info{font-size:12px;opacity:.5;font-weight:500}.earn-hero .comparison{margin-top:10px}.earn-hero .comparison span{font-size:11px;opacity:.7;font-weight:600;display:flex;align-items:center;gap:4px}
.earn-row{display:flex;justify-content:space-between;align-items:center;padding:12px 4px;border-bottom:1px solid var(--b1);font-size:13px;border-radius:4px;transition:background .2s}.earn-row:hover{background:var(--bg3)}.earn-row:last-child{border:none;padding-top:14px;border-top:1.5px solid var(--b2);font-size:15px}.earn-row .k{color:var(--t2);display:flex;align-items:center;gap:7px;font-weight:500}.earn-row .k i{width:18px;text-align:center;font-size:14px;color:var(--p)}.earn-row .v{font-weight:700;color:var(--t1)}.earn-row .v.plus{color:var(--g)}.earn-row .v.minus{color:var(--r)}
.esb{background:var(--bg3);border:1.5px solid var(--b1);border-radius:var(--rad);padding:18px;margin-top:16px;position:relative;overflow:hidden}.esb::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--pg)}.esb .esb-title{font-size:11px;font-weight:700;color:var(--t3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:14px;display:flex;align-items:center;gap:6px}.esb .esb-title i{color:var(--p);font-size:13px}
.esb .esb-grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px}.esb .esb-item{text-align:center;padding:10px 6px;background:var(--card);border-radius:10px;border:1px solid var(--b1)}.esb .esb-item .esb-val{font-size:15px;font-weight:900;margin-bottom:2px}.esb .esb-item .esb-lbl{font-size:8px;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:.3px}
.esb .esb-progress{margin-top:14px}.esb .esb-pbar{height:8px;background:var(--bg);border-radius:4px;overflow:hidden}.esb .esb-pfill{height:100%;border-radius:4px;transition:width .8s cubic-bezier(.16,1,.3,1)}.esb .esb-pmeta{display:flex;justify-content:space-between;margin-top:6px;font-size:10px;font-weight:600;color:var(--t3)}
.esb .esb-detail{margin-top:14px;padding-top:12px;border-top:1px solid var(--b1)}.esb .esd{display:flex;justify-content:space-between;align-items:center;padding:6px 0;font-size:12px}.esb .esd .ek{color:var(--t2);display:flex;align-items:center;gap:6px;font-weight:500}.esb .esd .ek i{color:var(--p);font-size:12px;width:16px;text-align:center}.esb .esd .ev{font-weight:800;color:var(--t1)}.esb .esd .ev.pos{color:var(--g)}.esb .esd .ev.neg{color:var(--r)}.esb .esd.total{border-top:1.5px solid var(--b2);padding-top:10px;margin-top:4px;font-size:14px}.esb .esd.total .ev{color:var(--p);font-size:16px}
.cal-earn-bar{background:var(--p4);border:1px solid var(--b1);border-radius:10px;padding:10px 14px;margin-top:12px;display:flex;align-items:center;justify-content:space-between;font-size:12px;font-weight:600;gap:12px;flex-wrap:wrap}.cal-earn-bar .ceb{display:flex;align-items:center;gap:5px;color:var(--t2)}.cal-earn-bar .ceb b{font-weight:800;color:var(--t1)}.cal-earn-bar .ceb b.accent{color:var(--p)}.cal-earn-bar .ceb i{color:var(--p);font-size:11px}
.s-card{max-width:580px;margin-bottom:16px}.s-card h3{font-size:14px;font-weight:800;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--b1);display:flex;align-items:center;gap:8px;color:var(--t1)}.s-card h3 i{color:var(--p);font-size:14px}
.salary-preview{background:var(--bg3);border:1px solid var(--b1);border-radius:12px;padding:20px;margin-top:14px;text-align:center}.salary-preview .amt{font-size:30px;font-weight:900;color:var(--p)}.salary-preview .det{font-size:12px;color:var(--t2);margin-top:4px;font-weight:600}
.hint{background:var(--p4);border:1px solid rgba(255,255,255,.04);border-radius:10px;padding:12px 14px;font-size:12px;color:var(--p3);display:flex;align-items:start;gap:8px;margin-bottom:14px;font-weight:500;line-height:1.5}.hint i{margin-top:1px;font-size:13px;flex-shrink:0;color:var(--p)}
.data-btns{display:flex;gap:8px;flex-wrap:wrap}.empty{text-align:center;padding:36px 16px;color:var(--t3)}.empty i{font-size:36px;margin-bottom:10px;opacity:.2;display:block}.empty p{font-size:13px;font-weight:600}.empty .empty-action{margin-top:12px}
.theme-picker{display:flex;gap:8px;flex-wrap:wrap}.theme-dot{width:36px;height:36px;border-radius:50%;cursor:pointer;border:3px solid transparent;transition:all .2s}.theme-dot:hover{transform:scale(1.15)}.theme-dot.active{border-color:var(--t1);box-shadow:0 0 0 2px var(--bg),0 0 0 4px var(--t1)}.theme-dot[data-t="default"]{background:linear-gradient(135deg,#7c3aed,#8b5cf6)}.theme-dot[data-t="ocean"]{background:linear-gradient(135deg,#0891b2,#06b6d4)}.theme-dot[data-t="forest"]{background:linear-gradient(135deg,#16a34a,#22c55e)}.theme-dot[data-t="sunset"]{background:linear-gradient(135deg,#ea580c,#f97316)}.theme-dot[data-t="rose"]{background:linear-gradient(135deg,#e11d48,#f43f5e)}.theme-dot[data-t="gold"]{background:linear-gradient(135deg,#d97706,#f59e0b)}
.year-overview{display:grid;grid-template-columns:repeat(12,1fr);gap:3px;margin-bottom:20px}.year-month{padding:8px 4px;border-radius:8px;text-align:center;background:var(--card2);border:1px solid var(--b1);cursor:pointer;transition:all .2s;font-size:10px;font-weight:700}.year-month:hover{border-color:var(--p);background:var(--p4)}.year-month.active{border-color:var(--p);background:var(--p4)}.year-month .ym-hrs{font-size:14px;font-weight:900;display:block;margin-top:2px;color:var(--p)}.year-month .ym-name{color:var(--t3);font-size:9px;display:block;margin-bottom:2px}
.cal-cell.selecting{border-color:var(--s)!important;background:rgba(56,189,248,.1)!important}
.kbd{display:inline-block;padding:2px 6px;border-radius:4px;background:var(--bg3);border:1px solid var(--b1);font-size:10px;font-weight:700;color:var(--t3);font-family:monospace}
@media(max-width:768px){.content{padding:122px 12px 28px}.grid-2,.grid-3{grid-template-columns:1fr}.stats{grid-template-columns:repeat(2,1fr)}.cal-cell{min-height:56px;padding:4px 5px}.cal-cell .shift-time,.cal-cell .leave-label,.cal-cell .hol-tag{display:none}.earn-hero .amt{font-size:24px}.nav-tab span{display:none}.nav-tab{padding:10px 12px;border-radius:10px}.nav-tab i{font-size:18px}.login-cards{flex-direction:column;align-items:center}.year-overview{grid-template-columns:repeat(6,1fr)}.page-head{flex-direction:column;align-items:flex-start}.esb .esb-grid{grid-template-columns:1fr 1fr}.cal-earn-bar{flex-direction:column;align-items:flex-start}}
@media(max-width:480px){.stats{grid-template-columns:1fr}.lt-row{grid-template-columns:1fr}.year-overview{grid-template-columns:repeat(4,1fr)}.esb .esb-grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="toast-container" id="toastContainer"></div>
<div class="confirm-overlay" id="confirmOverlay"><div class="confirm-box"><div class="confirm-icon ci-danger" id="confirmIcon"><i class="fas fa-exclamation-triangle"></i></div><h4 id="confirmTitle">Emin misiniz?</h4><p id="confirmMsg"></p><div class="confirm-btns"><button class="btn btn-ghost btn-sm" onclick="confirmCancel()">İptal</button><button class="btn btn-danger btn-sm" onclick="confirmOk()"><i class="fas fa-check"></i>Onayla</button></div></div></div>
<div id="loginScreen"><div class="login-container"><div class="login-brand"><div class="icon"><i class="fas fa-clock"></i></div><h1>ShiftTrack Pro</h1><p>Akıllı Vardiya & Kazanç Yönetimi</p><span class="version">v2.4</span></div><div class="login-cards"><div class="login-card" onclick="login(1)"><div class="avatar" id="la1">1</div><h3 id="ln1">Kullanıcı 1</h3><span>Giriş yap →</span><div class="user-theme-indicator" id="uti1"></div><span class="last-login" id="ll1"></span></div><div class="login-card" onclick="login(2)"><div class="avatar" id="la2">2</div><h3 id="ln2">Kullanıcı 2</h3><span>Giriş yap →</span><div class="user-theme-indicator" id="uti2"></div><span class="last-login" id="ll2"></span></div></div></div></div>
<div id="mainApp">
<header class="topbar"><div class="topbar-brand"><div class="ico"><i class="fas fa-clock"></i></div>ShiftTrack</div><div class="topbar-right"><div class="topbar-user" onclick="go('settings',document.querySelectorAll('.nav-tab')[4])"><div class="av" id="topAv">U</div><span id="topName">Kullanıcı</span></div><button class="topbar-logout" onclick="logout()" title="Çıkış"><i class="fas fa-sign-out-alt"></i></button></div></header>
<nav class="nav-tabs"><button class="nav-tab active" onclick="go('dashboard',this)"><i class="fas fa-th-large"></i><span>Panel</span></button><button class="nav-tab" onclick="go('calendar',this)"><i class="fas fa-calendar-alt"></i><span>Takvim</span></button><button class="nav-tab" onclick="go('leaves',this)"><i class="fas fa-umbrella-beach"></i><span>İzinler</span></button><button class="nav-tab" onclick="go('earnings',this)"><i class="fas fa-wallet"></i><span>Kazanç</span></button><button class="nav-tab" onclick="go('settings',this)"><i class="fas fa-cog"></i><span>Ayarlar</span></button></nav>
<main class="content">
<div class="page active" id="pg-dashboard"><div class="page-head"><div><h1>Kontrol Paneli</h1><p id="dashSub"></p></div><div id="dashStreak"></div></div><div class="stats" id="statsEl"></div><div class="year-overview" id="yearOverview"></div><div class="grid-2"><div class="card"><div class="card-head"><h3><i class="fas fa-chart-bar"></i>Haftalık Saatler</h3><span style="font-size:10px;color:var(--t3)">Limit: 45s</span></div><div class="week-chart" id="weekChart"></div></div><div class="card"><div class="card-head"><h3><i class="fas fa-info-circle"></i>Özet</h3></div><div class="info-list" id="dashInfo"></div></div></div><div id="dashEarnSummary"></div><div class="grid-3" id="shiftDistGrid" style="display:none"><div class="card" style="grid-column:1/3"><div class="card-head"><h3><i class="fas fa-layer-group"></i>Vardiya Dağılımı</h3><span style="font-size:10px;color:var(--t3)" id="sdMonthLabel"></span></div><div class="shift-dist" id="shiftDistList" style="display:flex;flex-direction:column;gap:12px"></div></div><div class="card"><div class="card-head"><h3><i class="fas fa-chart-pie"></i>Oran</h3></div><div id="shiftDistDonut"></div><div class="sd-summary" id="shiftDistChips"></div></div></div></div>
<div class="page" id="pg-calendar"><div class="page-head"><div><h1>Vardiya Takvimi</h1><p>Güne tıklayarak giriş yapın</p></div><div style="display:flex;gap:6px"><button class="btn btn-outline btn-sm" onclick="toggleMultiSelect()" id="multiSelBtn"><i class="fas fa-object-group"></i>Çoklu Seç</button><button class="btn btn-soft btn-sm" onclick="goToday()"><i class="fas fa-crosshairs"></i>Bugün</button></div></div><div id="copyBar"></div><div id="multiBar"></div><div class="card"><div class="cal-controls"><div class="cal-nav"><button class="cal-nav-btn" onclick="chgM(-1)"><i class="fas fa-chevron-left"></i></button><span class="cal-month-title" id="calTitle"></span><button class="cal-nav-btn" onclick="chgM(1)"><i class="fas fa-chevron-right"></i></button></div><div><span style="font-size:11px;color:var(--t3);font-weight:600" id="calSummary"></span></div></div><div class="cal-grid" id="calGrid"></div><div id="calEarnBar"></div><div class="cal-legend"><span><i class="fas fa-circle" style="color:var(--p)"></i>Bugün</span><span><i class="fas fa-circle" style="color:var(--g)"></i>Vardiya</span><span><i class="fas fa-circle" style="color:var(--r)"></i>Tatil</span><span><i class="fas fa-circle" style="color:#60a5fa"></i>Y.İzin</span><span><i class="fas fa-circle" style="color:#fb923c"></i>Rapor</span><span><i class="fas fa-circle" style="color:var(--p)"></i>H.Tatil</span></div></div></div>
<div class="page" id="pg-leaves"><div class="page-head"><div><h1>İzin Yönetimi</h1><p>İzin haklarınız</p></div></div><div class="leave-cards" id="leaveCards"></div><div class="card"><div class="card-head"><h3><i class="fas fa-history"></i>Geçmiş — <span id="leaveYr"></span></h3><select id="leaveFilter" onchange="renderLeaves()" style="padding:4px 8px;font-size:11px;width:auto"><option value="all">Tümü</option><option value="annual">Yıllık İzin</option><option value="sick">Rapor</option><option value="weekly">H.Tatil</option><option value="unpaid">Ücretsiz</option></select></div><div id="leaveTable"></div></div></div>
<div class="page" id="pg-earnings"><div class="page-head"><div><h1>Kazanç Raporu</h1><p>Aylık gelir detayları</p></div></div><div class="cal-controls" style="margin-bottom:16px"><div class="cal-nav"><button class="cal-nav-btn" onclick="chgE(-1)"><i class="fas fa-chevron-left"></i></button><span class="cal-month-title" id="earnTitle"></span><button class="cal-nav-btn" onclick="chgE(1)"><i class="fas fa-chevron-right"></i></button></div></div><div id="earnContent"></div></div>
<div class="page" id="pg-settings"><div class="page-head"><div><h1>Ayarlar</h1><p>Kişisel bilgiler ve görünüm</p></div></div><div class="card s-card"><h3><i class="fas fa-palette"></i>Tema Rengi <span style="font-size:10px;color:var(--t3);font-weight:500;margin-left:4px">(kişisel)</span></h3><div class="hint"><i class="fas fa-info-circle"></i><span>Tema bu kullanıcıya özeldir.</span></div><div class="theme-picker" id="themePicker"><div class="theme-dot" data-t="default" onclick="setTheme('default')"></div><div class="theme-dot" data-t="ocean" onclick="setTheme('ocean')"></div><div class="theme-dot" data-t="forest" onclick="setTheme('forest')"></div><div class="theme-dot" data-t="sunset" onclick="setTheme('sunset')"></div><div class="theme-dot" data-t="rose" onclick="setTheme('rose')"></div><div class="theme-dot" data-t="gold" onclick="setTheme('gold')"></div></div></div><div class="card s-card"><h3><i class="fas fa-user"></i>Kişisel Bilgiler</h3><div class="fg"><label>Ad Soyad</label><input type="text" id="sName" placeholder="Adınız" onchange="sSet('name',this.value)"></div><div class="fg"><label>İşe Başlama</label><input type="date" id="sStart" onchange="sSet('startDate',this.value)"></div><div id="seniorityInfo"></div></div><div class="card s-card"><h3><i class="fas fa-money-bill-wave"></i>Maaş</h3><div class="hint"><i class="fas fa-lightbulb"></i><span>Net maaş girin. Tam ay çalışınca bu maaşı alırsınız. FM ×1.5, Tatil çalışma ×1 ek olarak eklenir. Eksik günler kesilir.</span></div><div class="fg"><label>Aylık Net (₺)</label><input type="number" id="sSalary" placeholder="25000" min="0" step="100" onchange="sSet('netSalary',this.value)"></div><div class="salary-preview" id="salPrev" style="display:none"><div class="amt" id="salAmt">₺0</div><div class="det" id="salDet"></div></div></div><div class="card s-card"><h3><i class="fas fa-calendar-check"></i>Yıllık İzin</h3><div class="hint"><i class="fas fa-balance-scale"></i><span>1–5yıl→14g, 5–15→20g, 15+→26g</span></div><div class="fg"><label>İzin Hakkı (gün)</label><input type="number" id="sLeave" placeholder="14" min="0" max="40" onchange="sSet('annualLeave',this.value)"></div></div><div class="card s-card"><h3><i class="fas fa-clock"></i>Vardiya Ön Tanımları</h3><div class="hint"><i class="fas fa-info-circle"></i><span>Özel şablonlar ekleyebilirsiniz.</span></div><div id="customPresets"></div><button class="btn btn-soft btn-sm" onclick="addCustomPreset()" style="margin-top:8px"><i class="fas fa-plus"></i>Şablon Ekle</button></div><div class="card s-card"><h3><i class="fas fa-keyboard"></i>Klavye Kısayolları</h3><div class="info-list"><div class="info-row"><span class="k"><kbd class="kbd">Esc</kbd></span><span class="v" style="font-size:12px;color:var(--t2)">Modalı kapat</span></div><div class="info-row"><span class="k"><kbd class="kbd">←</kbd> <kbd class="kbd">→</kbd></span><span class="v" style="font-size:12px;color:var(--t2)">Ay değiştir</span></div><div class="info-row"><span class="k"><kbd class="kbd">T</kbd></span><span class="v" style="font-size:12px;color:var(--t2)">Bugüne git</span></div></div></div><div class="card s-card"><h3><i class="fas fa-database"></i>Veri Yönetimi</h3><div class="data-btns"><button class="btn btn-outline" onclick="exportD()"><i class="fas fa-download"></i>Yedekle</button><button class="btn btn-outline" onclick="document.getElementById('impF').click()"><i class="fas fa-upload"></i>Yükle</button><input type="file" id="impF" style="display:none" accept=".json" onchange="importD(event)"><button class="btn btn-danger" onclick="clearD()"><i class="fas fa-trash"></i>Sıfırla</button></div><div style="margin-top:12px;font-size:11px;color:var(--t3)"><i class="fas fa-info-circle" style="color:var(--p)"></i> Veriler tarayıcıda saklanır.</div></div></div>
</main></div>
<div class="overlay" id="modal"><div class="modal"><div class="modal-top"><div style="display:flex;align-items:center;gap:8px"><h3 id="mTitle">16</h3><span class="date-badge" id="mDate">Pzt</span></div><button class="modal-x" onclick="closeM()"><i class="fas fa-times"></i></button></div><div class="modal-body"><div id="mAlert" class="h-alert" style="display:none"><i class="fas fa-flag"></i><span id="mAlertTx"></span></div><div class="mode-tabs"><button class="mode-tab active" onclick="mMode('shift',this)"><i class="fas fa-clock"></i>Vardiya</button><button class="mode-tab" onclick="mMode('leave',this)"><i class="fas fa-umbrella-beach"></i>İzin</button></div><div id="mShift"><div class="preset-row" id="presetRow"></div><div class="time-inputs"><div class="ti"><label>Giriş</label><input type="time" id="iStart" value="08:00"></div><div class="ti"><label>Çıkış</label><input type="time" id="iEnd" value="16:00"></div><div class="ti"><label>Mola</label><select id="iBreak"><option value="0">Yok</option><option value="15">15dk</option><option value="30" selected>30dk</option><option value="45">45dk</option><option value="60">1s</option><option value="90">1.5s</option></select></div></div><div class="result-box"><div class="rb-item"><div class="rb-val" id="rbGross">8s</div><div class="rb-lbl">Brüt</div></div><div class="rb-div"></div><div class="rb-item"><div class="rb-val accent" id="rbBreak">30dk</div><div class="rb-lbl">Mola</div></div><div class="rb-div"></div><div class="rb-item"><div class="rb-val green" id="rbNet">7.5s</div><div class="rb-lbl">Net</div></div><div class="rb-div"></div><div class="rb-item"><div class="rb-val" id="rbOT" style="color:var(--t3)">—</div><div class="rb-lbl">F.Mesai</div></div></div><div id="mEarningPreview" style="margin-top:8px;text-align:center;font-size:11px;color:var(--t2);font-weight:600"></div></div><div id="mLeave" style="display:none"><div class="lt-row"><div class="lt-opt" data-t="annual" onclick="selLT('annual',this)"><i class="fas fa-umbrella-beach" style="color:#60a5fa"></i>Yıllık İzin<small>Ücretli</small></div><div class="lt-opt" data-t="weekly" onclick="selLT('weekly',this)"><i class="fas fa-couch" style="color:var(--p)"></i>Hafta Tatili<small>Ücretli</small></div><div class="lt-opt" data-t="sick" onclick="selLT('sick',this)"><i class="fas fa-notes-medical" style="color:#fb923c"></i>Rapor<small>Hastalık</small></div><div class="lt-opt" data-t="unpaid" onclick="selLT('unpaid',this)"><i class="fas fa-ban" style="color:var(--r)"></i>Ücretsiz<small>Kesinti</small></div></div><div class="fg"><label>Not</label><input type="text" id="iNote" placeholder="Opsiyonel..."></div></div></div><div class="modal-foot"><button class="btn btn-outline btn-sm" id="mCopy" onclick="copyShift()" style="display:none;margin-right:auto" title="Kopyala"><i class="fas fa-copy"></i></button><button class="btn btn-danger btn-sm" id="mDel" onclick="delEntry()" style="display:none"><i class="fas fa-trash"></i>Sil</button><button class="btn btn-ghost btn-sm" onclick="closeM()">İptal</button><button class="btn btn-primary btn-sm" onclick="saveEntry()"><i class="fas fa-check"></i>Kaydet</button></div></div></div>
<script>
const MTR=['Ocak','Şubat','Mart','Nisan','Mayıs','Haziran','Temmuz','Ağustos','Eylül','Ekim','Kasım','Aralık'],DTR=['Pzt','Sal','Çar','Per','Cum','Cmt','Paz'],DFL=['Pazartesi','Salı','Çarşamba','Perşembe','Cuma','Cumartesi','Pazar'],MH=225;
const PRESETS={morning:{start:'08:00',end:'16:00',break:30},afternoon:{start:'12:00',end:'20:00',break:30},evening:{start:'16:00',end:'00:00',break:30},custom:null};
const FH=[{m:1,d:1,n:'Yılbaşı'},{m:4,d:23,n:'23 Nisan'},{m:5,d:1,n:'1 Mayıs'},{m:5,d:19,n:'19 Mayıs'},{m:7,d:15,n:'15 Temmuz'},{m:8,d:30,n:'30 Ağustos'},{m:10,d:29,n:'29 Ekim'}];
const RH={2024:[{m:4,d:10,n:'Ramazan B.'},{m:4,d:11,n:'Ramazan B.'},{m:4,d:12,n:'Ramazan B.'},{m:6,d:17,n:'Kurban B.'},{m:6,d:18,n:'Kurban B.'},{m:6,d:19,n:'Kurban B.'},{m:6,d:20,n:'Kurban B.'}],2025:[{m:3,d:30,n:'Ramazan B.'},{m:3,d:31,n:'Ramazan B.'},{m:4,d:1,n:'Ramazan B.'},{m:6,d:6,n:'Kurban B.'},{m:6,d:7,n:'Kurban B.'},{m:6,d:8,n:'Kurban B.'},{m:6,d:9,n:'Kurban B.'}],2026:[{m:3,d:20,n:'Ramazan B.'},{m:3,d:21,n:'Ramazan B.'},{m:3,d:22,n:'Ramazan B.'},{m:5,d:27,n:'Kurban B.'},{m:5,d:28,n:'Kurban B.'},{m:5,d:29,n:'Kurban B.'},{m:5,d:30,n:'Kurban B.'}],2027:[{m:3,d:9,n:'Ramazan B.'},{m:3,d:10,n:'Ramazan B.'},{m:3,d:11,n:'Ramazan B.'},{m:5,d:16,n:'Kurban B.'},{m:5,d:17,n:'Kurban B.'},{m:5,d:18,n:'Kurban B.'},{m:5,d:19,n:'Kurban B.'}]};
const THEME_COLORS={default:'linear-gradient(135deg,#7c3aed,#8b5cf6)',ocean:'linear-gradient(135deg,#0891b2,#06b6d4)',forest:'linear-gradient(135deg,#16a34a,#22c55e)',sunset:'linear-gradient(135deg,#ea580c,#f97316)',rose:'linear-gradient(135deg,#e11d48,#f43f5e)',gold:'linear-gradient(135deg,#d97706,#f59e0b)'},THEME_NAMES={default:'Mor',ocean:'Okyanus',forest:'Orman',sunset:'Gün Batımı',rose:'Gül',gold:'Altın'};
let S={cu:null,cm:new Date().getMonth(),cy:new Date().getFullYear(),em:new Date().getMonth(),ey:new Date().getFullYear(),sd:null,mt:'shift',lt:null,clipboard:null,multiSelect:false,selectedDates:[],u:{1:{name:'Kullanıcı 1',netSalary:0,startDate:'',annualLeave:14,shifts:{},leaves:{},customPresets:[],lastLogin:null,theme:'default'},2:{name:'Kullanıcı 2',netSalary:0,startDate:'',annualLeave:14,shifts:{},leaves:{},customPresets:[],lastLogin:null,theme:'default'}}};
let confirmCallback=null;
function toast(msg,type='info'){const c=document.getElementById('toastContainer'),ic={success:'fa-check-circle',error:'fa-times-circle',info:'fa-info-circle',warning:'fa-exclamation-triangle'},t=document.createElement('div');t.className=`toast t-${type}`;t.innerHTML=`<i class="fas ${ic[type]}"></i><span>${msg}</span>`;c.appendChild(t);setTimeout(()=>t.remove(),3100)}
function showConfirm(t,m,cb){document.getElementById('confirmTitle').textContent=t;document.getElementById('confirmMsg').textContent=m;confirmCallback=cb;document.getElementById('confirmOverlay').classList.add('show')}
function confirmOk(){document.getElementById('confirmOverlay').classList.remove('show');if(confirmCallback)confirmCallback();confirmCallback=null}
function confirmCancel(){document.getElementById('confirmOverlay').classList.remove('show');confirmCallback=null}
function init(){loadLS();applyTheme('default');updLogin();document.getElementById('iStart').addEventListener('input',updResult);document.getElementById('iEnd').addEventListener('input',updResult);document.getElementById('iBreak').addEventListener('change',updResult);document.addEventListener('keydown',e=>{if(e.key==='Escape'){closeM();document.getElementById('confirmOverlay').classList.remove('show')}if(document.getElementById('modal').classList.contains('show'))return;if(e.target.tagName==='INPUT'||e.target.tagName==='SELECT')return;if(e.key==='ArrowLeft'){const pg=document.querySelector('.page.active');if(pg.id==='pg-calendar')chgM(-1);else if(pg.id==='pg-earnings')chgE(-1)}if(e.key==='ArrowRight'){const pg=document.querySelector('.page.active');if(pg.id==='pg-calendar')chgM(1);else if(pg.id==='pg-earnings')chgE(1)}if(e.key.toLowerCase()==='t'&&document.querySelector('.page.active').id==='pg-calendar')goToday()})}
function updLogin(){[1,2].forEach(i=>{const u=S.u[i];document.getElementById('ln'+i).textContent=u.name||'Kullanıcı '+i;document.getElementById('la'+i).textContent=(u.name||'K')[0].toUpperCase();const ll=document.getElementById('ll'+i);ll.textContent=u.lastLogin?'Son: '+new Date(u.lastLogin).toLocaleDateString('tr-TR',{day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'}):'';document.getElementById('uti'+i).innerHTML=`<span class="uti-dot" style="background:${THEME_COLORS[u.theme||'default']}"></span><span class="uti-text">${THEME_NAMES[u.theme||'default']}</span>`})}
function login(id){S.cu=id;cu().lastLogin=new Date().toISOString();applyTheme(cu().theme||'default');saveLS();document.getElementById('loginScreen').style.display='none';document.getElementById('mainApp').style.display='block';updTop();renderAll();toast(`Hoş geldin, ${cu().name||'Kullanıcı'}!`,'success')}
function logout(){S.cu=null;S.multiSelect=false;S.selectedDates=[];S.clipboard=null;applyTheme('default');document.getElementById('mainApp').style.display='none';document.getElementById('loginScreen').style.display='flex';updLogin();document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));document.querySelector('.nav-tab').classList.add('active');document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('pg-dashboard').classList.add('active')}
function updTop(){const u=cu();document.getElementById('topName').textContent=u.name||'İsimsiz';document.getElementById('topAv').textContent=(u.name||'K')[0].toUpperCase()}
function cu(){return S.u[S.cu]}
function go(p,btn){document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));document.getElementById('pg-'+p).classList.add('active');document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));if(btn)btn.classList.add('active');renderAll()}
function renderAll(){renderDash();renderCal();renderLeaves();renderEarn();loadSet();renderYearOverview();renderShiftDist()}
function setTheme(t){if(!S.cu)return;cu().theme=t;applyTheme(t);saveLS();toast(`${THEME_NAMES[t]} teması`,'info')}
function applyTheme(t){document.body.className=t==='default'?'':'theme-'+t;document.querySelectorAll('.theme-dot').forEach(d=>d.classList.toggle('active',d.dataset.t===t))}
function getH(ds){const d=new Date(ds),y=d.getFullYear(),m=d.getMonth()+1,day=d.getDate();for(const h of FH)if(h.m===m&&h.d===day)return h.n;const r=RH[y];if(r)for(const h of r)if(h.m===m&&h.d===day)return h.n;return null}
function isH(ds){return getH(ds)!==null}
function calcHr(s,e,b){const[sh,sm]=s.split(':').map(Number),[eh,em]=e.split(':').map(Number);let st=sh*60+sm,en=eh*60+em;if(en<=st)en+=1440;return Math.max(0,(en-st-b)/60)}
function grossHr(s,e){const[sh,sm]=s.split(':').map(Number),[eh,em]=e.split(':').map(Number);let st=sh*60+sm,en=eh*60+em;if(en<=st)en+=1440;return Math.max(0,(en-st)/60)}
function getISOWeek(d){const dt=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate()));const dn=dt.getUTCDay()||7;dt.setUTCDate(dt.getUTCDate()+4-dn);const ys=new Date(Date.UTC(dt.getUTCFullYear(),0,1));return dt.getUTCFullYear()+'-W'+String(Math.ceil((((dt-ys)/864e5)+1)/7)).padStart(2,'0')}
function dStr(d){return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`}
function fm(n){if(!n||isNaN(n))return'₺0';return'₺'+n.toLocaleString('tr-TR',{minimumFractionDigits:0,maximumFractionDigits:2})}
function getStreak(){const u=cu();if(!u)return 0;let s=0,d=new Date();while(true){const ds=dStr(d);if(u.shifts[ds]||u.leaves[ds]){s++;d.setDate(d.getDate()-1)}else{const dw=d.getDay();if(dw===0||dw===6){d.setDate(d.getDate()-1);continue}break}}return s}

/* === ÇEKIRDEK HESAPLAMA — DOKUNULMADI === */
function getMD(y,m){const u=cu();if(!u)return{};const dim=new Date(y,m+1,0).getDate();let th=0,oh=0,hh=0,wd=0,hdw=0;const wh={};for(let d=1;d<=dim;d++){const s=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;const sh=u.shifts[s];if(!sh)continue;const hrs=calcHr(sh.start,sh.end,sh.break);if(hrs<=0)continue;th+=hrs;wd++;const dt=new Date(y,m,d);const wk=getISOWeek(dt);if(!wh[wk])wh[wk]=0;wh[wk]+=hrs;if(isH(s)){hh+=hrs;hdw++}}oh=0;let rh=0;Object.values(wh).forEach(w=>{if(w>45){oh+=w-45;rh+=45}else rh+=w});let yau=0,ysd=0,wr=0,ud=0;Object.entries(u.leaves).forEach(([k,v])=>{const ld=new Date(k);if(ld.getFullYear()===y){if(v.type==='annual')yau++;if(v.type==='sick')ysd++}if(ld.getFullYear()===y&&ld.getMonth()===m){if(v.type==='weekly')wr++;if(v.type==='unpaid')ud++}});const hr=u.netSalary>0?u.netSalary/MH:0;const bs=u.netSalary,op=oh*hr*1.5,hp=hh*hr,upd=ud*(u.netSalary/30),te=bs+op+hp-upd;return{th,rh,oh,hh,wd,hdw,wh,wr,ud,yau,ysd,hr,bs,op,hp,upd,te,dim}}
function getPrevMD(){let pm=S.cm-1,py=S.cy;if(pm<0){pm=11;py--}return getMD(py,pm)}

/* =============================================================
   KAZANÇ HESAPLAMA — Tam ay = net maaş mantığı
   
   Mantık:
   - Çalışan aylık net maaşa anlaşmıştır
   - Tam ay çalışırsa (hafta tatilleri dahil) → net maaşını alır
   - Ay kaç gün çekerse çeksin (28, 30, 31) fark etmez
   - Eksik gün varsa (ücretsiz izin, devamsızlık) → günlük kesinti
   - FM ve tatil çalışma → ek olarak eklenir
   
   Formül:
   Kazanç = NetMaaş - (eksikGün × günlükÜcret) + FM + TatilÇalışma
   
   Eksik gün = Ayın gün sayısı - (çalışılan + yıllık izin + rapor + hafta tatili)
   Günlük ücret = NetMaaş / ayın gerçek gün sayısı
   ============================================================= */
function calcDayBasedEarning(d, netSalary){
    if(!netSalary || netSalary<=0) return null;

    const daysInMonth  = d.dim;                    // Ayın gerçek gün sayısı (28/29/30/31)
    const dailyRate    = netSalary / daysInMonth;   // Günlük ücret = maaş / ayın gün sayısı
    const hourlyRate   = netSalary / MH;

    // Ücretli günler = Çalışılan gün + Hafta tatili + Yıllık izin + Rapor
    // (bu ayın yıllık izin ve raporunu hesapla)
    const u = cu();
    let monthAnnual = 0, monthSick = 0;
    const y = (d === getMD(S.ey, S.em)) ? S.ey : S.cy;
    const m = (d === getMD(S.ey, S.em)) ? S.em : S.cm;
    // Ay bazında yıllık izin ve rapor sayısını bul
    Object.entries(u.leaves).forEach(([k, v]) => {
        const ld = new Date(k);
        if(ld.getFullYear() === y && ld.getMonth() === m){
            if(v.type === 'annual') monthAnnual++;
            if(v.type === 'sick') monthSick++;
        }
    });

    const paidDays     = d.wd + d.wr + monthAnnual + monthSick;  // Ücretli günler
    const missingDays  = Math.max(0, daysInMonth - paidDays - d.ud);  // Giriş yapılmamış günler
    const totalAbsent  = d.ud + missingDays;       // Toplam eksik (ücretsiz + devamsız)

    // Tam ay çalışmışsa tam maaş, eksik varsa kesinti
    const basePay      = netSalary - (totalAbsent * dailyRate);
    const overtimePay  = d.oh * hourlyRate * 1.5;
    const holidayPay   = d.hh * hourlyRate;
    const totalEarning = Math.max(0, basePay + overtimePay + holidayPay);
    const workRatio    = paidDays / daysInMonth;

    return {
        dailyRate, basePay, overtimePay, holidayPay,
        unpaidDed: totalAbsent * dailyRate,
        totalEarning,
        paidDays,
        workedDays: d.wd,
        weeklyDays: d.wr,
        annualDays: monthAnnual,
        sickDays: monthSick,
        unpaidDays: d.ud,
        missingDays,
        totalAbsent,
        daysInMonth,
        totalHours: d.th,
        overtimeHours: d.oh,
        holidayHours: d.hh,
        workRatio,
        isFullMonth: totalAbsent === 0
    };
}

/* Bağlam-bağımsız versiyon: yıl ve ay parametresi alır */
function calcEarningForMonth(y, m, netSalary){
    const d = getMD(y, m);
    if(!netSalary || netSalary<=0) return null;

    const daysInMonth  = d.dim;
    const dailyRate    = netSalary / daysInMonth;
    const hourlyRate   = netSalary / MH;

    const u = cu();
    let monthAnnual = 0, monthSick = 0;
    Object.entries(u.leaves).forEach(([k, v]) => {
        const ld = new Date(k);
        if(ld.getFullYear() === y && ld.getMonth() === m){
            if(v.type === 'annual') monthAnnual++;
            if(v.type === 'sick') monthSick++;
        }
    });

    const paidDays     = d.wd + d.wr + monthAnnual + monthSick;
    const missingDays  = Math.max(0, daysInMonth - paidDays - d.ud);
    const totalAbsent  = d.ud + missingDays;

    const basePay      = netSalary - (totalAbsent * dailyRate);
    const overtimePay  = d.oh * hourlyRate * 1.5;
    const holidayPay   = d.hh * hourlyRate;
    const totalEarning = Math.max(0, basePay + overtimePay + holidayPay);
    const workRatio    = paidDays / daysInMonth;

    return {
        dailyRate, basePay, overtimePay, holidayPay,
        unpaidDed: totalAbsent * dailyRate,
        totalEarning, paidDays,
        workedDays: d.wd, weeklyDays: d.wr,
        annualDays: monthAnnual, sickDays: monthSick,
        unpaidDays: d.ud, missingDays, totalAbsent,
        daysInMonth, totalHours: d.th,
        overtimeHours: d.oh, holidayHours: d.hh,
        workRatio, isFullMonth: totalAbsent === 0,
        // getMD çıktısını da taşı
        _md: d
    };
}

function classifyShift(sh){const s=sh.start,e=sh.end;if(s==='08:00'&&e==='16:00')return'morning';if(s==='12:00'&&e==='20:00')return'afternoon';if(s==='16:00'&&e==='00:00')return'evening';const h=parseInt(s.split(':')[0]);if(h>=5&&h<11)return'morning';if(h>=11&&h<15)return'afternoon';if(h>=15&&h<21)return'evening';return'night'}
function getShiftDistribution(y,m){const u=cu();if(!u)return null;const dim=new Date(y,m+1,0).getDate();const dist={morning:{count:0,hours:0,label:'Sabah',icon:'🌅',time:'05–11'},afternoon:{count:0,hours:0,label:'Öğlen',icon:'🌇',time:'11–15'},evening:{count:0,hours:0,label:'Akşam',icon:'🌙',time:'15–21'},night:{count:0,hours:0,label:'Gece',icon:'🌃',time:'21–05'}};const cpMap={};if(u.customPresets){u.customPresets.forEach((cp,i)=>{cpMap['cp_'+i]={count:0,hours:0,label:cp.name,icon:cp.icon||'⏰',time:cp.start+'–'+cp.end,start:cp.start,end:cp.end,break:cp.break}})}let total=0;for(let d=1;d<=dim;d++){const s=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;const sh=u.shifts[s];if(!sh)continue;const hrs=calcHr(sh.start,sh.end,sh.break);if(hrs<=0)continue;total++;let matched=false;for(const[k,cp]of Object.entries(cpMap)){if(sh.start===cp.start&&sh.end===cp.end){cp.count++;cp.hours+=hrs;matched=true;break}}if(!matched){const cls=classifyShift(sh);dist[cls].count++;dist[cls].hours+=hrs}}for(const[k,cp]of Object.entries(cpMap)){if(cp.count>0)dist[k]=cp}return{dist,total}}
function renderShiftDist(){const u=cu();if(!u)return;const r=getShiftDistribution(S.cy,S.cm);const g=document.getElementById('shiftDistGrid');if(!r||r.total===0){g.style.display='none';return}g.style.display='grid';document.getElementById('sdMonthLabel').textContent=MTR[S.cm]+' '+S.cy;const items=Object.entries(r.dist).filter(([,v])=>v.count>0).sort((a,b)=>b[1].count-a[1].count);if(!items.length){g.style.display='none';return}let lH='';items.forEach(([k,v])=>{const p=Math.round(v.count/r.total*100);lH+=`<div class="sd-item"><div class="sd-icon">${v.icon}</div><div class="sd-info"><div class="sd-name">${v.label}</div><div class="sd-time">${v.time} • ${v.hours.toFixed(1)}s</div><div class="sd-bar-wrap"><div class="sd-bar" style="width:${Math.max(5,p)}%"></div></div></div><div class="sd-stats"><div><div class="sd-count">${v.count}</div><div class="sd-unit">gün</div></div><div class="sd-pct">%${p}</div></div></div>`});document.getElementById('shiftDistList').innerHTML=lH;const cs=getComputedStyle(document.documentElement),pC=cs.getPropertyValue('--p').trim()||'#a78bfa',p2C=cs.getPropertyValue('--p2').trim()||'#8b5cf6',p3C=cs.getPropertyValue('--p3').trim()||'#c4b5fd',aC=cs.getPropertyValue('--acc').trim()||'#fbbf24',dC=[pC,p2C,aC,p3C,'#94a3b8','#64748b'],R=38,circ=2*Math.PI*R;let segs='',off=0;items.forEach(([,v],i)=>{const p=v.count/r.total,d=p*circ;segs+=`<circle cx="50" cy="50" r="${R}" fill="none" stroke="${dC[i%dC.length]}" stroke-width="12" stroke-dasharray="${d} ${circ-d}" stroke-dashoffset="${-off}" stroke-linecap="round" opacity=".85"/>`;off+=d});document.getElementById('shiftDistDonut').innerHTML=`<div class="sd-donut"><svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="${R}" fill="none" stroke="var(--bg3)" stroke-width="12"/>${segs}</svg><div class="donut-center"><div class="dc-val">${r.total}</div><div class="dc-lbl">Vardiya</div></div></div>`;let cH='';items.forEach(([,v],i)=>cH+=`<div class="sd-chip"><span class="chip-dot" style="background:${dC[i%dC.length]}"></span>${v.label}: ${v.count}g</div>`);document.getElementById('shiftDistChips').innerHTML=cH}
function renderYearOverview(){const el=document.getElementById('yearOverview');let h='';for(let m=0;m<12;m++){const d=getMD(S.cy,m);h+=`<div class="year-month ${m===S.cm?'active':''}" onclick="S.cm=${m};renderAll()"><span class="ym-name">${MTR[m].substring(0,3)}</span><span class="ym-hrs">${d.th?d.th.toFixed(0):'—'}</span></div>`}el.innerHTML=h}

function renderDash(){const u=cu();if(!u)return;const d=getMD(S.cy,S.cm),prev=getPrevMD();document.getElementById('dashSub').textContent=`${MTR[S.cm]} ${S.cy} — ${u.name}`;const streak=getStreak();document.getElementById('dashStreak').innerHTML=streak>0?`<div class="streak-badge"><i class="fas fa-fire"></i>${streak} gün seri</div>`:'';
const e=u.netSalary?calcEarningForMonth(S.cy,S.cm,u.netSalary):null;
function cmp(c,p){if(!p)return'<span class="change neutral">—</span>';const df=c-p,pc=p?((df/p)*100).toFixed(0):0;if(df>0)return`<span class="change up"><i class="fas fa-arrow-up"></i>${pc}%</span>`;if(df<0)return`<span class="change down"><i class="fas fa-arrow-down"></i>${Math.abs(pc)}%</span>`;return'<span class="change neutral">→ 0%</span>'}
document.getElementById('statsEl').innerHTML=`<div class="stat"><div class="ribbon"></div><div class="ico"><i class="fas fa-clock"></i></div><div class="val">${d.th.toFixed(1)}</div><div class="lbl">Toplam Saat</div>${cmp(d.th,prev.th)}</div><div class="stat"><div class="ribbon"></div><div class="ico"><i class="fas fa-fire"></i></div><div class="val">${d.oh.toFixed(1)}</div><div class="lbl">Fazla Mesai</div>${cmp(d.oh,prev.oh)}</div><div class="stat"><div class="ribbon"></div><div class="ico"><i class="fas fa-wallet"></i></div><div class="val">${e?fm(e.totalEarning):'—'}</div><div class="lbl">Kazanç</div></div><div class="stat"><div class="ribbon"></div><div class="ico"><i class="fas fa-flag"></i></div><div class="val">${d.hdw}</div><div class="lbl">Tatil Çalışma</div></div><div class="stat"><div class="ribbon"></div><div class="ico"><i class="fas fa-calendar-check"></i></div><div class="val">${d.wd}/${d.dim}</div><div class="lbl">Çalışma Günü</div></div>`;
const wks=Object.entries(d.wh).sort((a,b)=>a[0].localeCompare(b[0]));let wc='';if(!wks.length)wc='<div class="empty"><i class="fas fa-calendar-times"></i><p>Bu ay vardiya yok</p><div class="empty-action"><button class="btn btn-soft btn-sm" onclick="go(\'calendar\',document.querySelectorAll(\'.nav-tab\')[1])"><i class="fas fa-plus"></i>Vardiya Ekle</button></div></div>';else wks.forEach(([,h],i)=>{const p=Math.min(100,h/60*100);wc+=`<div class="wk-row"><span class="label">${i+1}. Hafta</span><div class="track"><div class="limit-line" style="left:${45/60*100}%"></div><div class="fill ${h>45?'ot':'ok'}" style="width:${p}%">${h.toFixed(1)}s</div></div><span class="hrs ${h>45?'overtime':''}">${h.toFixed(1)}</span></div>`});document.getElementById('weekChart').innerHTML=wc;
const al=u.annualLeave||14,ar=al-d.yau;let info='';if(!u.netSalary)info='<div class="hint" style="margin-bottom:8px"><i class="fas fa-exclamation-triangle"></i><span>Ayarlar\'dan maaş girin.</span></div>';info+=`<div class="info-row"><span class="k"><i class="fas fa-umbrella-beach"></i>Kalan Y.İzin</span><span class="v ${ar<=3?'neg':''}">${ar}g</span></div><div class="info-row"><span class="k"><i class="fas fa-notes-medical"></i>Rapor</span><span class="v">${d.ysd}g</span></div><div class="info-row"><span class="k"><i class="fas fa-couch"></i>Hafta Tatili (ücretli)</span><span class="v">${d.wr}g</span></div><div class="info-row"><span class="k"><i class="fas fa-coins"></i>Saatlik</span><span class="v">${u.netSalary?fm(d.hr):'—'}</span></div><div class="info-row"><span class="k"><i class="fas fa-fire"></i>FM Ücreti</span><span class="v pos">${u.netSalary?fm(d.op):'—'}</span></div><div class="info-row"><span class="k"><i class="fas fa-chart-line"></i>Günlük Ort.</span><span class="v">${d.wd>0?(d.th/d.wd).toFixed(1)+'s':'—'}</span></div>`;document.getElementById('dashInfo').innerHTML=info;
const deb=document.getElementById('dashEarnSummary');
if(e&&(d.wd>0||d.wr>0)){
deb.innerHTML=`<div class="esb" style="margin-top:16px"><div class="esb-title"><i class="fas fa-calculator"></i>${MTR[S.cm]} Kazanç Özeti (${e.daysInMonth} günlük ay)</div><div class="esb-grid"><div class="esb-item"><div class="esb-val" style="color:var(--p)">${e.paidDays}<small style="font-size:11px;color:var(--t3)">g</small></div><div class="esb-lbl">Ücretli Gün</div></div><div class="esb-item"><div class="esb-val" style="color:${e.isFullMonth?'var(--g)':'var(--acc)'}"><small style="font-size:11px">${e.isFullMonth?'✓':'−'+e.totalAbsent+'g'}</small></div><div class="esb-lbl">${e.isFullMonth?'Tam Ay':'Eksik'}</div></div><div class="esb-item"><div class="esb-val" style="color:var(--g)">${fm(e.basePay)}</div><div class="esb-lbl">Maaş</div></div><div class="esb-item"><div class="esb-val" style="color:var(--acc)">${fm(e.totalEarning)}</div><div class="esb-lbl">Toplam</div></div></div><div class="esb-progress"><div class="esb-pbar"><div class="esb-pfill" style="width:${Math.min(100,e.workRatio*100)}%;background:var(--pg)"></div></div><div class="esb-pmeta"><span>${e.paidDays}/${e.daysInMonth} ücretli gün${e.isFullMonth?' — Tam maaş':''}</span><span>%${Math.round(e.workRatio*100)}</span></div></div></div>`}else deb.innerHTML=''}

function toggleMultiSelect(){S.multiSelect=!S.multiSelect;S.selectedDates=[];const btn=document.getElementById('multiSelBtn');if(S.multiSelect){btn.className='btn btn-primary btn-sm';btn.innerHTML='<i class="fas fa-check"></i>Bitir';toast('Çoklu seçim açık','info')}else{btn.className='btn btn-outline btn-sm';btn.innerHTML='<i class="fas fa-object-group"></i>Çoklu Seç'}renderCal()}
function renderMultiBar(){const el=document.getElementById('multiBar');if(!S.multiSelect||!S.selectedDates.length){el.innerHTML='';return}el.innerHTML=`<div class="multi-select-bar"><span><i class="fas fa-check-circle"></i> ${S.selectedDates.length} gün</span><div class="actions"><button class="btn btn-soft btn-xs" onclick="multiApplyShift()"><i class="fas fa-clock"></i>Vardiya</button><button class="btn btn-xs" style="background:rgba(96,165,250,.15);color:#60a5fa" onclick="multiApplyLeave('annual')">Y.İzin</button><button class="btn btn-xs" style="background:var(--p4);color:var(--p)" onclick="multiApplyLeave('weekly')">H.Tatil</button><button class="btn btn-danger btn-xs" onclick="multiClear()"><i class="fas fa-times"></i></button></div></div>`}
function multiApplyShift(){if(!S.selectedDates.length)return;S.selectedDates.forEach(ds=>{cu().shifts[ds]={start:'08:00',end:'16:00',break:30};delete cu().leaves[ds]});toast(`${S.selectedDates.length}g vardiya`,'success');S.selectedDates=[];saveLS();renderAll()}
function multiApplyLeave(t){if(!S.selectedDates.length)return;S.selectedDates.forEach(ds=>{cu().leaves[ds]={type:t,note:''};delete cu().shifts[ds]});toast(`${S.selectedDates.length}g izin`,'success');S.selectedDates=[];saveLS();renderAll()}
function multiClear(){S.selectedDates=[];renderCal()}

function renderCal(){const y=S.cy,m=S.cm;document.getElementById('calTitle').textContent=MTR[m]+' '+y;const g=document.getElementById('calGrid');g.innerHTML='';DTR.forEach(d=>{const e=document.createElement('div');e.className='cal-dname';e.textContent=d;g.appendChild(e)});const fd=new Date(y,m,1);let sd2=fd.getDay();sd2=sd2===0?6:sd2-1;const dim=new Date(y,m+1,0).getDate(),pip=new Date(y,m,0).getDate();const td=dStr(new Date()),u=cu();let mH=0,mD=0;
for(let i=sd2-1;i>=0;i--){const e=document.createElement('div');e.className='cal-cell out';e.innerHTML=`<div class="num">${pip-i}</div>`;g.appendChild(e)}
for(let d=1;d<=dim;d++){const s=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;const e=document.createElement('div');let c='cal-cell';if(s===td)c+=' today';const hol=getH(s),sh=u.shifts[s],lv=u.leaves[s];const dow=new Date(y,m,d).getDay();const dn=DTR[dow===0?6:dow-1];if(sh)c+=' has-shift';else if(lv)c+=' leave-'+lv.type;else if(hol)c+=' holiday';if(S.multiSelect&&S.selectedDates.includes(s))c+=' selecting';let inner=`<div class="num"><span>${d}</span><small>${dn}</small></div>`;if(sh){const h=calcHr(sh.start,sh.end,sh.break);mH+=h;mD++;inner+=`<div class="hrs-display ${h>7.5?'overtime':''}">${h.toFixed(1)}s</div><div class="shift-time">${sh.start}–${sh.end}</div>`;if(hol)inner+=`<span class="hol-tag">🏛️</span>`}else if(lv){const ic={annual:'fa-umbrella-beach',weekly:'fa-couch',sick:'fa-notes-medical',unpaid:'fa-ban'},lb={annual:'Yıllık İzin',weekly:'Hafta Tatili',sick:'Rapor',unpaid:'Ücretsiz İzin'};inner+=`<div class="leave-display ld-${lv.type}"><i class="fas ${ic[lv.type]}"></i>${lb[lv.type].split(' ')[0]}</div><span class="leave-label ll-${lv.type}">${lb[lv.type]}</span>`;if(hol)inner+=`<span class="hol-tag">${hol}</span>`}else if(hol)inner+=`<span class="hol-tag">${hol}</span>`;e.className=c;e.innerHTML=inner;e.onclick=()=>{if(S.multiSelect){const idx=S.selectedDates.indexOf(s);if(idx>-1)S.selectedDates.splice(idx,1);else S.selectedDates.push(s);renderCal();return}if(S.clipboard){pasteShift(s);return}openM(s)};g.appendChild(e)}
const tot=sd2+dim,rem=tot%7===0?0:7-(tot%7);for(let i=1;i<=rem;i++){const e=document.createElement('div');e.className='cal-cell out';e.innerHTML=`<div class="num">${i}</div>`;g.appendChild(e)}
document.getElementById('calSummary').textContent=mD>0?`${mD}g • ${mH.toFixed(1)}s`:'';
const ceb=document.getElementById('calEarnBar');const md=getMD(y,m);
if(u.netSalary>0&&(md.wd>0||md.wr>0)){const e=calcEarningForMonth(y,m,u.netSalary);ceb.innerHTML=`<div class="cal-earn-bar"><div class="ceb"><i class="fas fa-calendar"></i>${e.daysInMonth} günlük ay</div><div class="ceb"><i class="fas fa-calendar-check"></i>Ücretli: <b>${e.paidDays}g</b> ${e.isFullMonth?'<span style="color:var(--g)">✓ Tam</span>':'<span style="color:var(--acc)">−'+e.totalAbsent+'g</span>'}</div><div class="ceb"><i class="fas fa-money-bill"></i>Maaş: <b>${fm(e.basePay)}</b></div>${e.overtimePay>0?`<div class="ceb"><i class="fas fa-fire"></i>FM: <b style="color:var(--acc)">+${fm(e.overtimePay)}</b></div>`:''}${e.holidayPay>0?`<div class="ceb"><i class="fas fa-flag"></i>Tatil: <b style="color:var(--g)">+${fm(e.holidayPay)}</b></div>`:''}<div class="ceb"><i class="fas fa-wallet"></i>Toplam: <b class="accent">${fm(e.totalEarning)}</b></div></div>`}else ceb.innerHTML='';
renderCopyBar();renderMultiBar()}
function chgM(d){S.cm+=d;if(S.cm>11){S.cm=0;S.cy++}if(S.cm<0){S.cm=11;S.cy--}renderCal();renderDash();renderYearOverview();renderShiftDist()}
function goToday(){S.cm=new Date().getMonth();S.cy=new Date().getFullYear();renderCal();renderDash();renderYearOverview();renderShiftDist()}
function copyShift(){const sh=cu().shifts[S.sd];if(sh){S.clipboard={...sh};renderCopyBar();closeM();toast('Kopyalandı','info')}}
function pasteShift(ds){if(!S.clipboard)return;cu().shifts[ds]={...S.clipboard};delete cu().leaves[ds];saveLS();renderAll();toast('Yapıştırıldı','success')}
function clearClipboard(){S.clipboard=null;renderCopyBar()}
function renderCopyBar(){const el=document.getElementById('copyBar');if(S.clipboard){const h=calcHr(S.clipboard.start,S.clipboard.end,S.clipboard.break);el.innerHTML=`<div class="copy-bar"><span><i class="fas fa-clipboard"></i> ${S.clipboard.start}–${S.clipboard.end} (${h.toFixed(1)}s)</span><button class="btn btn-soft btn-xs" onclick="clearClipboard()"><i class="fas fa-times"></i></button></div>`}else el.innerHTML=''}
function openM(ds){if(S.clipboard){pasteShift(ds);return}S.sd=ds;const d=new Date(ds),dow=d.getDay(),dn=DFL[dow===0?6:dow-1];document.getElementById('mTitle').textContent=d.getDate()+' '+MTR[d.getMonth()];document.getElementById('mDate').textContent=dn;const hol=getH(ds),al=document.getElementById('mAlert');if(hol){al.style.display='flex';document.getElementById('mAlertTx').textContent=`${hol} — ek ücret`}else al.style.display='none';const u=cu(),sh=u.shifts[ds],lv=u.leaves[ds];mMode('shift',document.querySelectorAll('.mode-tab')[0]);S.lt=null;document.querySelectorAll('.lt-opt').forEach(o=>o.classList.remove('active'));document.getElementById('iNote').value='';renderModalPresets();if(sh){document.getElementById('iStart').value=sh.start;document.getElementById('iEnd').value=sh.end;document.getElementById('iBreak').value=String(sh.break);document.getElementById('mDel').style.display='inline-flex';document.getElementById('mCopy').style.display='inline-flex';hlPreset(sh)}else if(lv){mMode('leave',document.querySelectorAll('.mode-tab')[1]);const el2=document.querySelector(`.lt-opt[data-t="${lv.type}"]`);if(el2)selLT(lv.type,el2);document.getElementById('iNote').value=lv.note||'';document.getElementById('mDel').style.display='inline-flex';document.getElementById('mCopy').style.display='none'}else{document.getElementById('iStart').value='08:00';document.getElementById('iEnd').value='16:00';document.getElementById('iBreak').value='30';document.getElementById('mDel').style.display='none';document.getElementById('mCopy').style.display='none';applyPreset('morning',document.querySelector('.preset[data-key="morning"]'))}updResult();document.getElementById('modal').classList.add('show')}
function renderModalPresets(){const u=cu(),row=document.getElementById('presetRow');let h=`<div class="preset" data-key="morning" onclick="applyPreset('morning',this)"><span class="p-icon">🌅</span><span class="p-name">Sabah</span><span class="p-time">08–16</span></div><div class="preset" data-key="afternoon" onclick="applyPreset('afternoon',this)"><span class="p-icon">🌇</span><span class="p-name">Öğlen</span><span class="p-time">12–20</span></div><div class="preset" data-key="evening" onclick="applyPreset('evening',this)"><span class="p-icon">🌙</span><span class="p-name">Akşam</span><span class="p-time">16–00</span></div>`;if(u.customPresets?.length){u.customPresets.forEach((cp,i)=>{PRESETS['cp_'+i]={start:cp.start,end:cp.end,break:cp.break};h+=`<div class="preset" data-key="cp_${i}" onclick="applyPreset('cp_${i}',this)"><span class="p-icon">${cp.icon||'⏰'}</span><span class="p-name">${cp.name}</span><span class="p-time">${cp.start.substring(0,2)}–${cp.end.substring(0,2)}</span></div>`})}h+=`<div class="preset" data-key="custom" onclick="applyPreset('custom',this)"><span class="p-icon">⚙️</span><span class="p-name">Özel</span><span class="p-time">Serbest</span></div>`;row.innerHTML=h}
function hlPreset(sh){document.querySelectorAll('.preset').forEach(p=>p.classList.remove('active'));for(const[k,v]of Object.entries(PRESETS)){if(v&&v.start===sh.start&&v.end===sh.end&&v.break===sh.break){const el=document.querySelector(`.preset[data-key="${k}"]`);if(el){el.classList.add('active');return}}}const c=document.querySelector('.preset[data-key="custom"]');if(c)c.classList.add('active')}
function closeM(){document.getElementById('modal').classList.remove('show')}
function mMode(t,btn){S.mt=t;document.querySelectorAll('.mode-tab').forEach(b=>b.classList.remove('active'));if(btn)btn.classList.add('active');document.getElementById('mShift').style.display=t==='shift'?'block':'none';document.getElementById('mLeave').style.display=t==='leave'?'block':'none'}
function selLT(t,el){S.lt=t;document.querySelectorAll('.lt-opt').forEach(o=>o.classList.remove('active'));if(el)el.classList.add('active')}
function applyPreset(key,el){document.querySelectorAll('.preset').forEach(p=>p.classList.remove('active'));if(el)el.classList.add('active');if(key!=='custom'&&PRESETS[key]){document.getElementById('iStart').value=PRESETS[key].start;document.getElementById('iEnd').value=PRESETS[key].end;document.getElementById('iBreak').value=String(PRESETS[key].break)}updResult()}
function updResult(){const s=document.getElementById('iStart').value,e=document.getElementById('iEnd').value,b=parseInt(document.getElementById('iBreak').value)||0;if(!s||!e)return;const net=calcHr(s,e,b),gross=grossHr(s,e);document.getElementById('rbGross').textContent=gross.toFixed(1)+'s';document.getElementById('rbBreak').textContent=b+'dk';document.getElementById('rbNet').textContent=net.toFixed(1)+'s';const ot=net>7.5?net-7.5:0;document.getElementById('rbOT').textContent=ot>0?'+'+ot.toFixed(1)+'s':'—';document.getElementById('rbOT').style.color=ot>0?'var(--acc)':'var(--t3)';const u=cu(),ep=document.getElementById('mEarningPreview');if(u.netSalary>0&&net>0){const hr=u.netSalary/MH,isHol=isH(S.sd);let earn=0;if(isHol)earn=net*hr;if(ot>0)earn+=ot*hr*0.5;ep.textContent=earn>0?`💰 Ek kazanç: ~${fm(earn)}`:'Ek kazanç yok'}else ep.textContent=''}
function saveEntry(){const u=cu(),s=S.sd;if(S.mt==='shift'){const st=document.getElementById('iStart').value,en=document.getElementById('iEnd').value,br=parseInt(document.getElementById('iBreak').value)||0;if(!st||!en){toast('Saatleri girin','error');return}const hrs=calcHr(st,en,br);if(hrs<=0){toast('Geçersiz aralık','error');return}if(hrs>16){toast('16s sınırı','warning');return}u.shifts[s]={start:st,end:en,break:br};delete u.leaves[s];toast(`${hrs.toFixed(1)}s kaydedildi`,'success')}else{if(!S.lt){toast('Tür seçin','error');return}const lb={annual:'Yıllık İzin',weekly:'Hafta Tatili',sick:'Rapor',unpaid:'Ücretsiz İzin'};if(S.lt==='annual'){const al=u.annualLeave||14,d=getMD(S.cy,S.cm);if(d.yau>=al&&!u.leaves[s]){toast('İzin hakkı doldu!','error');return}}u.leaves[s]={type:S.lt,note:document.getElementById('iNote').value};delete u.shifts[s];toast(`${lb[S.lt]} kaydedildi`,'success')}saveLS();closeM();renderAll()}
function delEntry(){showConfirm('Sil','Bu girdiyi silmek istiyor musunuz?',()=>{delete cu().shifts[S.sd];delete cu().leaves[S.sd];saveLS();closeM();renderAll();toast('Silindi','success')})}
document.getElementById('modal').addEventListener('click',function(e){if(e.target===this)closeM()});
function renderLeaves(){const u=cu(),y=S.cy,d=getMD(y,S.cm),at=u.annualLeave||14,ar=at-d.yau;document.getElementById('leaveYr').textContent=y;document.getElementById('leaveCards').innerHTML=`<div class="card leave-c"><h4><i class="fas fa-umbrella-beach" style="color:#60a5fa"></i>Yıllık İzin</h4><div class="big" style="color:#60a5fa">${ar} <small>/ ${at}g</small></div><div class="pbar"><div class="pf" style="width:${Math.min(100,(d.yau/Math.max(at,1))*100)}%;background:linear-gradient(90deg,#3b82f6,#60a5fa)"></div></div><div class="meta"><span>Kullanılan: ${d.yau}</span><span>Kalan: ${ar}</span></div></div><div class="card leave-c"><h4><i class="fas fa-notes-medical" style="color:#fb923c"></i>Rapor</h4><div class="big" style="color:#fb923c">${d.ysd} <small>gün</small></div><div class="pbar"><div class="pf" style="width:${Math.min(100,d.ysd/20*100)}%;background:linear-gradient(90deg,#f59e0b,#fbbf24)"></div></div><div class="meta"><span>Bu yıl</span><span>${d.ysd}g</span></div></div><div class="card leave-c"><h4><i class="fas fa-couch" style="color:var(--p)"></i>Hafta Tatili</h4><div class="big" style="color:var(--p)">${d.wr} <small>gün</small></div><div class="pbar"><div class="pf" style="width:${Math.min(100,d.wr/5*100)}%;background:var(--pg)"></div></div><div class="meta"><span>${MTR[S.cm]} (ücretli)</span><span>${d.wr}g</span></div></div><div class="card leave-c"><h4><i class="fas fa-ban" style="color:var(--r)"></i>Ücretsiz</h4><div class="big" style="color:var(--r)">${d.ud} <small>gün</small></div><div class="pbar"><div class="pf" style="width:${Math.min(100,d.ud/5*100)}%;background:linear-gradient(90deg,#ef4444,#f87171)"></div></div><div class="meta"><span>Kesinti</span><span>${u.netSalary?fm(d.ud*(u.netSalary/d.dim)):'—'}</span></div></div>`;
const filter=document.getElementById('leaveFilter')?.value||'all';const all=Object.entries(u.leaves).filter(([k,v])=>{if(new Date(k).getFullYear()!==y)return false;return filter==='all'||v.type===filter}).sort((a,b)=>b[0].localeCompare(a[0]));if(!all.length){document.getElementById('leaveTable').innerHTML='<div class="empty"><i class="fas fa-check-circle"></i><p>Kayıt yok</p></div>';return}const tl={annual:'Yıllık',weekly:'H.Tatil',sick:'Rapor',unpaid:'Ücretsiz'},tc={annual:'a',weekly:'w',sick:'s',unpaid:'u'};let t='<table><thead><tr><th>Tarih</th><th>Gün</th><th>Tür</th><th>Not</th><th></th></tr></thead><tbody>';all.forEach(([k,v])=>{const dd=new Date(k),dow=dd.getDay();t+=`<tr><td>${dd.getDate()} ${MTR[dd.getMonth()]}</td><td>${DFL[dow===0?6:dow-1]}</td><td><span class="tag tag-${tc[v.type]}">${tl[v.type]}</span></td><td style="color:var(--t2)">${v.note||'—'}</td><td><button class="btn btn-danger btn-xs" onclick="delLv('${k}')"><i class="fas fa-trash"></i></button></td></tr>`});t+='</tbody></table>';document.getElementById('leaveTable').innerHTML=t}
function delLv(k){showConfirm('Sil','Bu izni silmek istiyor musunuz?',()=>{delete cu().leaves[k];saveLS();renderAll();toast('Silindi','success')})}

function renderEarn(){const u=cu(),y=S.ey,m=S.em;document.getElementById('earnTitle').textContent=MTR[m]+' '+y;const d=getMD(y,m);
if(!u.netSalary){document.getElementById('earnContent').innerHTML='<div class="hint"><i class="fas fa-exclamation-triangle"></i><span>Ayarlar\'dan maaş girin.</span></div>';return}
if(d.wd===0&&d.wr===0){document.getElementById('earnContent').innerHTML='<div class="empty"><i class="fas fa-calendar-times"></i><p>Bu ay veri yok</p></div>';return}
const e=calcEarningForMonth(y,m,u.netSalary);

let pm=m-1,py=y;if(pm<0){pm=11;py--}const prevE=calcEarningForMonth(py,pm,u.netSalary);const diff=prevE&&prevE.totalEarning>0?e.totalEarning-prevE.totalEarning:0;

document.getElementById('earnContent').innerHTML=`
<div class="earn-hero"><div class="sub">KAZANÇ — ${MTR[m].toUpperCase()} ${y} (${e.daysInMonth} GÜN)</div><div class="amt">${fm(e.totalEarning)}</div><div class="info">${e.isFullMonth?'Tam ay çalışma — Net maaş + ekler':'Eksik gün var — '+e.totalAbsent+'g kesinti'} • ${e.totalHours.toFixed(1)} saat</div>${prevE&&prevE.totalEarning>0?`<div class="comparison"><span>${diff>=0?'↑':'↓'} Önceki aya göre ${fm(Math.abs(diff))}</span></div>`:''}</div>

<div class="esb">
<div class="esb-title"><i class="fas fa-calculator"></i>Kazanç Detayı — ${e.daysInMonth} Günlük Ay</div>
<div class="esb-grid">
<div class="esb-item"><div class="esb-val" style="color:var(--p)">${e.workedDays}<small style="font-size:11px;color:var(--t3)">g</small></div><div class="esb-lbl">Çalışılan</div></div>
<div class="esb-item"><div class="esb-val" style="color:var(--p)">${e.weeklyDays+e.annualDays+e.sickDays}<small style="font-size:11px;color:var(--t3)">g</small></div><div class="esb-lbl">Ücretli İzin</div></div>
<div class="esb-item"><div class="esb-val" style="color:${e.isFullMonth?'var(--g)':'var(--acc)'}"><small style="font-size:11px">${e.isFullMonth?'✓ TAM':'−'+e.totalAbsent+'g'}</small></div><div class="esb-lbl">${e.isFullMonth?'Tam Ay':'Eksik'}</div></div>
<div class="esb-item"><div class="esb-val" style="color:var(--t1)">${fm(e.dailyRate)}</div><div class="esb-lbl">Günlük (/${e.daysInMonth})</div></div>
</div>
<div class="esb-progress"><div class="esb-pbar"><div class="esb-pfill" style="width:${Math.min(100,e.workRatio*100)}%;background:${e.isFullMonth?'var(--pg)':'linear-gradient(90deg,var(--acc),#fbbf24)'}"></div></div><div class="esb-pmeta"><span>${e.paidDays}/${e.daysInMonth} ücretli gün${e.isFullMonth?' — Tam maaş':''}</span><span>%${Math.round(e.workRatio*100)}</span></div></div>
<div class="esb-detail">
<div class="esd"><span class="ek"><i class="fas fa-money-bill"></i>Net Maaş (anlaşılan)</span><span class="ev">${fm(u.netSalary)}</span></div>
${e.totalAbsent>0?`<div class="esd"><span class="ek"><i class="fas fa-minus-circle"></i>Eksik Gün Kesintisi (${e.totalAbsent}g × ${fm(e.dailyRate)})</span><span class="ev neg">-${fm(e.totalAbsent*e.dailyRate)}</span></div>`:''}
${e.totalAbsent>0?`<div class="esd"><span class="ek" style="padding-left:22px;font-size:10px;color:var(--t3)">↳ ${e.unpaidDays>0?e.unpaidDays+'g ücretsiz izin':''} ${e.missingDays>0?(e.unpaidDays>0?' + ':'')+e.missingDays+'g giriş yapılmamış':''}</span><span class="ev" style="font-size:10px;color:var(--t3)"></span></div>`:''}
<div class="esd"><span class="ek"><i class="fas fa-equals"></i>Ay Maaşı</span><span class="ev">${fm(e.basePay)}</span></div>
<div class="esd"><span class="ek"><i class="fas fa-fire"></i>Fazla Mesai (${e.overtimeHours.toFixed(1)}s × ${fm(d.hr)} × 1.5)</span><span class="ev pos">+${fm(e.overtimePay)}</span></div>
<div class="esd"><span class="ek"><i class="fas fa-flag"></i>Tatil Çalışma (${e.holidayHours.toFixed(1)}s × ${fm(d.hr)})</span><span class="ev pos">+${fm(e.holidayPay)}</span></div>
<div class="esd total"><span class="ek"><i class="fas fa-wallet"></i><b>TOPLAM KAZANÇ</b></span><span class="ev">${fm(e.totalEarning)}</span></div>
</div>
</div>

<div style="margin-top:12px;padding:12px;background:var(--bg3);border-radius:10px;border:1px solid var(--b1)">
<div style="font-size:11px;font-weight:700;color:var(--t3);margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px"><i class="fas fa-list" style="color:var(--p);margin-right:4px"></i>Gün Dağılımı</div>
<div style="display:flex;gap:6px;flex-wrap:wrap">
<span style="padding:4px 10px;border-radius:6px;background:rgba(52,211,153,.1);color:var(--g);font-size:11px;font-weight:700">Çalışma: ${e.workedDays}g</span>
${e.weeklyDays>0?`<span style="padding:4px 10px;border-radius:6px;background:var(--p4);color:var(--p);font-size:11px;font-weight:700">H.Tatil: ${e.weeklyDays}g</span>`:''}
${e.annualDays>0?`<span style="padding:4px 10px;border-radius:6px;background:rgba(96,165,250,.15);color:#60a5fa;font-size:11px;font-weight:700">Y.İzin: ${e.annualDays}g</span>`:''}
${e.sickDays>0?`<span style="padding:4px 10px;border-radius:6px;background:rgba(251,146,60,.15);color:#fb923c;font-size:11px;font-weight:700">Rapor: ${e.sickDays}g</span>`:''}
${e.unpaidDays>0?`<span style="padding:4px 10px;border-radius:6px;background:rgba(248,113,113,.1);color:var(--r);font-size:11px;font-weight:700">Ücretsiz: ${e.unpaidDays}g</span>`:''}
${e.missingDays>0?`<span style="padding:4px 10px;border-radius:6px;background:rgba(148,163,184,.1);color:#94a3b8;font-size:11px;font-weight:700">Boş: ${e.missingDays}g</span>`:''}
</div>
</div>

<div class="card" style="margin-top:16px"><div class="card-head"><h3><i class="fas fa-chart-pie"></i>Saat Dağılımı</h3></div><div class="info-list">
<div class="info-row"><span class="k"><i class="fas fa-clock"></i>Toplam</span><span class="v">${d.th.toFixed(1)}s</span></div>
<div class="info-row"><span class="k"><i class="fas fa-check-circle"></i>Normal</span><span class="v">${d.rh.toFixed(1)}s</span></div>
<div class="info-row"><span class="k"><i class="fas fa-fire"></i>Fazla Mesai</span><span class="v warn">${d.oh.toFixed(1)}s</span></div>
<div class="info-row"><span class="k"><i class="fas fa-flag"></i>Tatil</span><span class="v">${d.hh.toFixed(1)}s (${d.hdw}g)</span></div>
<div class="info-row"><span class="k"><i class="fas fa-chart-line"></i>Günlük Ort.</span><span class="v">${d.wd>0?(d.th/d.wd).toFixed(1)+'s':'—'}</span></div>
</div></div>`}
function chgE(d){S.em+=d;if(S.em>11){S.em=0;S.ey++}if(S.em<0){S.em=11;S.ey--}renderEarn()}
function loadSet(){const u=cu();if(!u)return;document.getElementById('sName').value=u.name||'';document.getElementById('sSalary').value=u.netSalary||'';document.getElementById('sStart').value=u.startDate||'';document.getElementById('sLeave').value=u.annualLeave||14;updSal();updSeniority();renderCustomPresets();applyTheme(u.theme||'default')}
function sSet(k,v){const u=cu();if(k==='netSalary')v=parseFloat(v)||0;if(k==='annualLeave')v=parseInt(v)||14;u[k]=v;if(k==='startDate'&&v){const s=new Date(v),n=new Date(),yr=(n-s)/(365.25*864e5);let l=14;if(yr>=15)l=26;else if(yr>=5)l=20;u.annualLeave=l;document.getElementById('sLeave').value=l}saveLS();updTop();updSal();updSeniority();renderAll();toast('Kaydedildi','success')}
function updSal(){const u=cu(),el=document.getElementById('salPrev');if(u.netSalary>0){el.style.display='block';document.getElementById('salAmt').textContent=fm(u.netSalary);document.getElementById('salDet').textContent=`Saatlik: ${fm(u.netSalary/MH)} | Günlük (30g): ${fm(u.netSalary/30)} | FM: ${fm(u.netSalary/MH*1.5)}`}else el.style.display='none'}
function updSeniority(){const u=cu(),el=document.getElementById('seniorityInfo');if(u.startDate){const s=new Date(u.startDate),n=new Date(),df=n-s,y=Math.floor(df/(365.25*864e5)),m=Math.floor((df%(365.25*864e5))/(30.44*864e5));el.innerHTML=`<div style="margin-top:8px;padding:10px 12px;background:var(--bg3);border-radius:8px;border:1px solid var(--b1);font-size:12px;color:var(--t2)"><i class="fas fa-briefcase" style="color:var(--p);margin-right:6px"></i>Kıdem: <strong style="color:var(--t1)">${y} yıl ${m} ay</strong></div>`}else el.innerHTML=''}
function renderCustomPresets(){const u=cu(),el=document.getElementById('customPresets');if(!u.customPresets)u.customPresets=[];if(!u.customPresets.length){el.innerHTML='<div style="font-size:12px;color:var(--t3)">Şablon yok.</div>';return}let h='';u.customPresets.forEach((cp,i)=>{h+=`<div style="display:flex;align-items:center;gap:8px;padding:8px;background:var(--bg3);border-radius:8px;margin-bottom:6px;border:1px solid var(--b1)"><span style="font-size:18px">${cp.icon||'⏰'}</span><div style="flex:1"><div style="font-size:12px;font-weight:700;color:var(--t1)">${cp.name}</div><div style="font-size:10px;color:var(--t3)">${cp.start}–${cp.end} (${cp.break}dk)</div></div><button class="btn btn-danger btn-xs" onclick="delPreset(${i})"><i class="fas fa-trash"></i></button></div>`});el.innerHTML=h}
function addCustomPreset(){const name=prompt('Ad:');if(!name)return;const icon=prompt('Emoji:','⏰')||'⏰';const start=prompt('Giriş:','22:00');if(!start)return;const end=prompt('Çıkış:','06:00');if(!end)return;const brk=parseInt(prompt('Mola (dk):','30'))||0;cu().customPresets.push({name,icon,start,end,break:brk});saveLS();renderCustomPresets();toast(`"${name}" eklendi`,'success')}
function delPreset(i){cu().customPresets.splice(i,1);saveLS();renderCustomPresets();toast('Silindi','success')}
function saveLS(){localStorage.setItem('st_data',JSON.stringify({users:S.u}))}
function loadLS(){const s=localStorage.getItem('st_data');if(s){try{const p=JSON.parse(s);if(p.users){if(p.users[1])S.u[1]={...S.u[1],...p.users[1]};if(p.users[2])S.u[2]={...S.u[2],...p.users[2]}}else{if(p[1])S.u[1]={...S.u[1],...p[1]};if(p[2])S.u[2]={...S.u[2],...p[2]};if(p.theme){S.u[1].theme=p.theme;S.u[2].theme=p.theme}}}catch(e){console.error(e)}}}
function exportD(){const b=new Blob([JSON.stringify({users:S.u},null,2)],{type:'application/json'}),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download=`shifttrack_${dStr(new Date())}.json`;a.click();URL.revokeObjectURL(u);toast('İndirildi','success')}
function importD(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=function(ev){try{const p=JSON.parse(ev.target.result);if(p.users){if(p.users[1])S.u[1]={...S.u[1],...p.users[1]};if(p.users[2])S.u[2]={...S.u[2],...p.users[2]}}else{if(p[1])S.u[1]={...S.u[1],...p[1]};if(p[2])S.u[2]={...S.u[2],...p[2]}}saveLS();applyTheme(cu().theme||'default');renderAll();updTop();toast('Yüklendi!','success')}catch{toast('Geçersiz','error')}};r.readAsText(f);e.target.value=''}
function clearD(){showConfirm('Sıfırla','Tüm veriler silinecek!',()=>{S.u[S.cu]={name:'Kullanıcı '+S.cu,netSalary:0,startDate:'',annualLeave:14,shifts:{},leaves:{},customPresets:[],lastLogin:cu().lastLogin,theme:cu().theme};saveLS();renderAll();updTop();loadSet();toast('Sıfırlandı','success')})}
init();
</script>
</body>
</html>
